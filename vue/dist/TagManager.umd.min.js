(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/TagManager/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},a5a2:function(e,t){e.exports=n},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ImportVersion",(function(){return f})),n.d(t,"VariableSelect",(function(){return q})),n.d(t,"VariableSelectType",(function(){return te})),n.d(t,"FieldTextareaVariable",(function(){return ue})),n.d(t,"FieldVariableTemplate",(function(){return ve})),n.d(t,"FieldVariableTypeTemplate",(function(){return Ce})),"undefined"!==typeof window){var a=window.document.currentScript,r=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(n.p=r[1])}var i=n("19dc"),o=n("8bbf"),l={class:"tagManagerImportVersion"},c={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},s=["value"],u=["value"];function d(e,t,n,a,r,i){var d=Object(o["resolveComponent"])("ActivityIndicator"),p=Object(o["resolveComponent"])("Field"),b=Object(o["resolveComponent"])("SaveButton"),m=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",l,[Object(o["createVNode"])(m,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(o["createVNode"])(d,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(p,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.backupName=t}),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(p,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.importContent=t}),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(o["createVNode"])(b,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=function(t){return e.importVersion(e.backupName,e.importContent)}),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,s),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,u)],512)])}var p=n("a5a2"),b="importContainerVersion",m=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:i["ContentBlock"],ActivityIndicator:i["ActivityIndicator"],Field:p["Field"],SaveButton:p["SaveButton"]},data:function(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification:function(e,t){var n=i["NotificationsStore"].show({message:e,context:t,type:"transient",id:b});setTimeout((function(){i["NotificationsStore"].scrollToNotification(n)}),200)},importVersion:function(e,t){var n=this;if(t){var a;try{a=JSON.parse(t)}catch(r){return void this.showNotification(Object(i["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in a&&"triggers"in a&&"variables"in a&&"idcontainer"in a&&"context"in a?i["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:function(){n.isUpdating=!0;var e={exportedContainerVersion:t};i["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:n.idContainer,backupName:n.backupName},e).then((function(){n.showNotification(Object(i["translate"])("TagManager_VersionImportSuccess"),"success"),n.isUpdating=!1,window.location.reload()})).catch((function(){n.isUpdating=!1}))}}):this.showNotification(Object(i["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}}},computed:{backupNameTitle:function(){return"".concat(Object(i["translate"])("TagManager_BackupVersionName")," (").concat(Object(i["translate"])("General_Recommended"),")")}}});m.render=d;var f=m,g=(Object(i["createAngularJsAdapter"])({component:f,scope:{idContainer:{angularJsBind:"="}},directiveName:"piwikImportVersion"}),{class:"tagManagerManageSelect tagManagerVariableSelect"}),V={class:"tableActionBar"},h=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),v={class:"collection with-header"},j={class:"collection-header"},O=["onClick"],y={class:"title"},C={class:"secondary-content"},T=["onClick","title"],N={class:"collection-header"},w=["onClick"],S={class:"title"},M={class:"secondary-content"},k=["title"],A={class:"tableActionBar"},E=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function x(e,t,n,a,r,i){var l=Object(o["resolveComponent"])("ActivityIndicator");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",g,[Object(o["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(o["createElementVNode"])("div",V,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},[h,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])]),Object(o["createElementVNode"])("ul",v,[Object(o["createElementVNode"])("li",j,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(t,n){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",onClick:function(n){return e.selectVariable(t)},key:n},[Object(o["createElementVNode"])("span",y,Object(o["toDisplayString"])(t.name)+" ("+Object(o["toDisplayString"])(e.translate("TagManager_Type"))+": "+Object(o["toDisplayString"])(t.type)+") ",1),Object(o["createElementVNode"])("span",C,[Object(o["createElementVNode"])("i",{class:"icon-edit",onClick:Object(o["withModifiers"])((function(n){return e.editVariable(t)}),["stop"]),title:e.translate("General_Edit")},null,8,T)])],8,O)})),128))]),Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.preconfiguredVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(o["createElementVNode"])("li",N,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,n){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:n,onClick:function(n){return e.selectVariable(t)}},[Object(o["createElementVNode"])("span",S,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",M,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,k)],512),[[o["vShow"],!!t.description]])],8,w)),[[o["vShow"],t.is_pre_configured]])})),128))])})),128)),Object(o["createElementVNode"])("div",A,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[E,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])])])}function _(e){return H(e)||L(e)||I(e)||B()}function B(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){if(e){if("string"===typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}function L(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function H(e){if(Array.isArray(e))return $(e)}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var D=window,F=D.tagManagerHelper,U=Object(o["defineComponent"])({props:{idContainer:{type:[String,Number],required:!0},idContainerVersion:[String,Number]},components:{ActivityIndicator:i["ActivityIndicator"]},data:function(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created:function(){this.fetchAvailableVariables()},watch:{idContainerVersion:function(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables:function(){var e=this;this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.actualIdContainerVersion=t.draft.idcontainerversion,i["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:e.idContainer,idContainerVersion:e.actualIdContainerVersion}).then((function(t){e.preconfiguredVariables=[],e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var n,a=Object.assign(Object.assign({},t),{},{types:t.types.filter((function(e){return e.is_pre_configured}))});(n=e.containerVariables).push.apply(n,_(t.types.filter((function(e){return!e.is_pre_configured})))),a.types.length&&e.preconfiguredVariables.push(a)}))})).catch((function(){e.isLoading=!1}))}))},editVariable:function(e){var t=this;this.actualIdContainerVersion&&F.editVariable(null,this.idContainer,this.actualIdContainerVersion,e.idvariable,(function(){t.fetchAvailableVariables()}))},createVariable:function(){var e=this;this.actualIdContainerVersion&&F.editVariable(null,this.idContainer,this.actualIdContainerVersion,0,(function(){e.fetchAvailableVariables()}))},selectVariable:function(e){this.$emit("selectVariable",{variable:e})},fetchContainer:function(){return this.isLoading=!0,i["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});U.render=x;var q=U,K=(Object(i["createAngularJsAdapter"])({component:q,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},onSelectVariable:{angularJsBind:"&?",vue:"selectVariable"}},directiveName:"piwikVariableSelect"}),{class:"tagManagerManageSelect tagManagerVariableSelectType"}),P=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function z(e,t,n,a,r,i){var l=Object(o["resolveComponent"])("Field");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",K,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"select",name:"variableType".concat(e.variableType),class:"selectVariableType","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.onChange(t)}),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(o["withModifiers"])((function(t){return e.createVariable()}),["prevent"]))},[P,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.variableTypeName)),1)],512),[[o["vShow"],!e.isLoading]])])}function J(e){return Y(e)||X(e)||R(e)||G()}function G(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function R(e,t){if(e){if("string"===typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}function X(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Y(e){if(Array.isArray(e))return Q(e)}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var W=window,Z=W.tagManagerHelper,ee=Object(o["defineComponent"])({props:{variableTypeName:{type:String,required:!0},modelValue:String,variableType:String},components:{Field:p["Field"]},emits:["update:modelValue"],data:function(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created:function(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables:function(){var e=this;this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.idContainerVersion=t.draft.idcontainerversion,i["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:i["MatomoUrl"].parsed.value.idContainer,idContainerVersion:e.idContainerVersion}).then((function(t){e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var n,a=t.types.filter((function(t){return t.type===e.variableType})).map((function(e){return{key:"{{".concat(e.id,"}}"),value:e.name}}));(n=e.containerVariables).push.apply(n,J(a))})),e.modelValue||1!==e.containerVariables.length||e.onChange(e.containerVariables[0].key)})).catch((function(){e.isLoading=!1}))}))},onChange:function(e){this.$emit("update:modelValue",e)},createVariable:function(){var e=this;this.idContainerVersion&&Z.editVariable(null,i["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,(function(t){e.fetchAvailableVariables(),t&&e.onChange("{{".concat(t.name,"}}"))}),this.variableType)},fetchContainer:function(){return this.isLoading=!0,i["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:i["MatomoUrl"].parsed.value.idContainer})}}});ee.render=z;var te=ee,ne=(Object(i["createAngularJsAdapter"])({component:te,scope:{variableTypeName:{angularJsBind:"@"},variable:{angularJsBind:"=",vue:"modelValue",default:function(e){return e.variable}},variableType:{angularJsBind:"@"}},directiveName:"piwikVariableSelectType",$inject:["$timeout"],events:{"update:modelValue":function(e,t,n,a,r,o,l){n.value=Object(i["clone"])(e),l()}},postCreate:function(e,t){t.$watch("variable",(function(t,n){t!==n&&Object(o["nextTick"])((function(){e.modelValue=Object(i["clone"])(t)}))}))}}),{class:"fieldVariableTemplate"}),ae=["type","id","name","value"],re=["title"],ie=["for","innerHTML"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function oe(e,t,n,a,r,i){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ne,[Object(o["createElementVNode"])("textarea",Object(o["mergeProps"])({class:"control_".concat(e.uiControl," materialize-textarea"),type:e.uiControl,id:e.name,name:e.name,value:e.modelValue,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"textarea"}),null,16,ae),Object(o["createElementVNode"])("span",{class:"icon-code",style:{"margin-top":"14px",position:"absolute"},title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,re),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,ie)])}var le=window,ce=le.tagManagerHelper,se=Object(o["defineComponent"])({props:{name:String,uiControlAttributes:Object,modelValue:String,title:String,uiControl:{type:String,required:!0}},inheritAttrs:!1,emits:["update:modelValue"],created:function(){this.onKeydown=Object(i["debounce"])(this.onKeydown.bind(this),50)},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;ce.selectVariable((function(t){ce.insertTextSnippetAtElement(e.$refs.textarea,"{{".concat(t.id,"}}"))}))}},watch:{modelValue:function(){var e=this,t=window,n=t.Materialize;setTimeout((function(){n.textareaAutoResize(e.$refs.textarea),n.updateTextFields()}))}},mounted:function(){var e=this,t=window,n=t.Materialize;setTimeout((function(){n.textareaAutoResize(e.$refs.textarea),n.updateTextFields()}))}});se.render=oe;var ue=se,de={class:"fieldVariableTemplate"},pe=["type","id","name","value"],be=["title"],me=["for","innerHTML"];function fe(e,t,n,a,r,i){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",de,[Object(o["createElementVNode"])("input",Object(o["mergeProps"])({class:"control_".concat(e.uiControl),type:e.uiControl,id:e.name,name:e.name,value:e.modelValueText,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"input"}),null,16,pe),Object(o["createElementVNode"])("span",{class:"icon-code",title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,be),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,me)])}var ge=window,Ve=ge.tagManagerHelper,he=Object(o["defineComponent"])({props:{uiControl:{type:String,required:!0},uiControlAttributes:Object,name:String,title:String,modelValue:String},inheritAttrs:!1,emits:["update:modelValue"],computed:{modelValueText:function(){return"undefined"===typeof this.modelValue||null===this.modelValue?"":this.modelValue.toString()}},created:function(){this.onKeydown=Object(i["debounce"])(this.onKeydown.bind(this),50)},mounted:function(){setTimeout((function(){window.Materialize.updateTextFields()}))},watch:{modelValue:function(){setTimeout((function(){window.Materialize.updateTextFields()}))}},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;Ve.selectVariable((function(t){Ve.insertTextSnippetAtElement(e.$refs.input,"{{".concat(t.id,"}}"))}))}}});he.render=fe;var ve=he,je=["for","innerHTML"];function Oe(e,t,n,a,r,i){var l=Object(o["resolveComponent"])("VariableSelectType");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createVNode"])(l,{"model-value":e.modelValue,id:e.name,name:e.name,"variable-type-name":e.title,"variable-type":e.uiControlAttributes.variableType,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t)})},null,8,["model-value","id","name","variable-type-name","variable-type"]),Object(o["createElementVNode"])("label",{for:e.name,style:{"font-size":"0.8rem"},innerHTML:e.$sanitize(e.title)},null,8,je)])}var ye=Object(o["defineComponent"])({props:{uiControlAttributes:{type:Object,required:!0},name:String,title:String,modelValue:String},components:{VariableSelectType:te},emits:["update:modelValue"]});ye.render=Oe;var Ce=ye;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=TagManager.umd.min.js.map