(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/TagManager/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"7b8a":function(e,t){},"8bbf":function(e,n){e.exports=t},a5a2:function(e,t){e.exports=n},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ImportVersion",(function(){return m})),n.d(t,"VariableSelect",(function(){return G})),n.d(t,"VariableSelectType",(function(){return oe})),"undefined"!==typeof window){var r=window.document.currentScript,a=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(n.p=a[1])}var i=n("19dc"),o=n("8bbf"),c={class:"tagManagerImportVersion"},l={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},s=["value"],u=["value"];function d(e,t,n,r,a,i){var d=Object(o["resolveComponent"])("ActivityIndicator"),b=Object(o["resolveComponent"])("Field"),p=Object(o["resolveComponent"])("SaveButton"),f=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",c,[Object(o["createVNode"])(f,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(o["createVNode"])(d,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(b,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.backupName=t}),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(b,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.importContent=t}),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(o["createVNode"])(p,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=function(t){return e.importVersion(e.backupName,e.importContent)}),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",l,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,s),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,u)],512)])}var b=n("a5a2"),p="importContainerVersion",f=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:i["ContentBlock"],ActivityIndicator:i["ActivityIndicator"],Field:b["Field"],SaveButton:b["SaveButton"]},data:function(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification:function(e,t){var n=i["NotificationsStore"].show({message:e,context:t,type:"transient",id:p});setTimeout((function(){i["NotificationsStore"].scrollToNotification(n)}),200)},importVersion:function(e,t){var n=this;if(t){var r;try{r=JSON.parse(t)}catch(a){return void this.showNotification(Object(i["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in r&&"triggers"in r&&"variables"in r&&"idcontainer"in r&&"context"in r?i["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:function(){n.isUpdating=!0;var e={exportedContainerVersion:t};i["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:n.idContainer,backupName:n.backupName},e).then((function(){n.showNotification(Object(i["translate"])("TagManager_VersionImportSuccess"),"success"),n.isUpdating=!1,window.location.reload()})).catch((function(){n.isUpdating=!1}))}}):this.showNotification(Object(i["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}}},computed:{backupNameTitle:function(){return"".concat(Object(i["translate"])("TagManager_BackupVersionName")," (").concat(Object(i["translate"])("General_Recommended"),")'")}}});f.render=d;var m=f,g=(Object(i["createAngularJsAdapter"])({component:m,scope:{idContainer:{angularJsBind:"="},onSomething:{angularJsBind:"&"}},directiveName:"piwikImportVersion"}),{class:"tagManagerManageSelect tagManagerVariableSelect"}),V={class:"tableActionBar"},j=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),v={class:"collection with-header"},h={class:"collection-header"},O=["onClick"],y={class:"title"},C={class:"secondary-content"},N=["onClick","title"],w={class:"collection-header"},S=["onClick"],T={class:"title"},k={class:"secondary-content"},M=["title"],A={class:"tableActionBar"},E=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function _(e,t,n,r,a,i){var c=Object(o["resolveComponent"])("ActivityIndicator");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",g,[Object(o["createVNode"])(c,{loading:e.isLoading},null,8,["loading"]),Object(o["createElementVNode"])("div",V,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},[j,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])]),Object(o["createElementVNode"])("ul",v,[Object(o["createElementVNode"])("li",h,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(t,n){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",onClick:function(n){return e.selectVariable(t)},key:n},[Object(o["createElementVNode"])("span",y,Object(o["toDisplayString"])(t.name)+" (Type: "+Object(o["toDisplayString"])(t.type)+")",1),Object(o["createElementVNode"])("span",C,[Object(o["createElementVNode"])("i",{class:"icon-edit",onClick:Object(o["withModifiers"])((function(n){return e.editVariable(t)}),["prevent"]),title:e.translate("General_Edit")},null,8,N)])],8,O)})),128))]),Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.preconfiguredVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(o["createElementVNode"])("li",w,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,n){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:n,onClick:function(n){return e.selectVariable(t)}},[Object(o["createElementVNode"])("span",T,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",k,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,M)],512),[[o["vShow"],!!t.description]])],8,S)),[[o["vShow"],t.is_pre_configured]])})),128))])})),128)),Object(o["createElementVNode"])("div",A,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[E,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])])])}function I(e){return P(e)||D(e)||x(e)||B()}function B(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(e,t){if(e){if("string"===typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}function D(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function P(e){if(Array.isArray(e))return L(e)}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){J(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=window,q=F.tagManagerHelper,$=Object(o["defineComponent"])({props:{idContainer:{type:[String,Number],required:!0},idContainerVersion:[String,Number]},components:{ActivityIndicator:i["ActivityIndicator"]},data:function(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created:function(){this.fetchAvailableVariables()},watch:{idContainerVersion:function(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables:function(){var e=this;this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.actualIdContainerVersion=t.draft.idcontainerversion,i["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:e.idContainer,idContainerVersion:e.actualIdContainerVersion}).then((function(t){e.preconfiguredVariables=[],e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var n,r=H(H({},t),{},{types:t.types.filter((function(e){return e.is_pre_configured}))});(n=e.containerVariables).push.apply(n,I(t.types.filter((function(e){return!e.is_pre_configured})))),r.types.length&&e.preconfiguredVariables.push(r)}))})).catch((function(){e.isLoading=!1}))}))},editVariable:function(e){var t=this;this.actualIdContainerVersion&&q.editVariable(null,this.idContainer,this.actualIdContainerVersion,e.idvariable,(function(){t.fetchAvailableVariables()}))},createVariable:function(){var e=this;this.actualIdContainerVersion&&q.editVariable(null,this.idContainer,this.actualIdContainerVersion,0,(function(){e.fetchAvailableVariables()}))},selectVariable:function(e){this.$emit("selectVariable",{variable:e})},fetchContainer:function(){return this.isLoading=!0,i["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});$.render=_;var G=$,X=(Object(i["createAngularJsAdapter"])({component:G,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},onSelectVariable:{angularJsBind:"&?"}},directiveName:"piwikVariableSelect"}),{class:"tagManagerManageSelect tagManagerVariableSelectType"}),R=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Y(e,t,n,r,a,i){var c=Object(o["resolveComponent"])("Field");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",X,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"select",name:"variableType".concat(e.variableType),class:"selectVariableType","model-value":e.variable,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.onChange(t)}),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(o["withModifiers"])((function(t){return e.createVariable()}),["prevent"]))},[R,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.variableTypeName)),1)],512),[[o["vShow"],!e.isLoading]])])}function z(e){return Z(e)||W(e)||Q(e)||K()}function K(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Q(e,t){if(e){if("string"===typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}function W(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Z(e){if(Array.isArray(e))return ee(e)}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var te=window,ne=te.tagManagerHelper,re=Object(o["defineComponent"])({props:{variableTypeName:{type:String,required:!0},variable:String,variableType:String},components:{Field:b["Field"]},emits:["update:modelValue"],data:function(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created:function(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables:function(){var e=this;this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.idContainerVersion=t.draft.idcontainerversion,i["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:i["MatomoUrl"].parsed.value.idContainer,idContainerVersion:e.idContainerVersion}).then((function(t){e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var n,r=t.types.filter((function(t){return t.type===e.variableType})).map((function(e){return{key:"{{".concat(e.id,"}}"),value:e.name}}));(n=e.containerVariables).push.apply(n,z(r))})),e.variable||1!==e.containerVariables.length||e.onChange(e.containerVariables[0].key)})).catch((function(){e.isLoading=!1}))}))},onChange:function(e){this.$emit("update:modelValue",e)},createVariable:function(){var e=this;this.idContainerVersion&&ne.editVariable(null,i["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,(function(t){e.fetchAvailableVariables(),t&&e.onChange("{{".concat(t.name,"}}"))}),this.variableType)},fetchContainer:function(){return this.isLoading=!0,i["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:i["MatomoUrl"].parsed.value.idContainer})}}}),ae=n("7b8a"),ie=n.n(ae);re.render=Y,"function"===typeof ie.a&&ie()(re);var oe=re;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(i["createAngularJsAdapter"])({component:oe,scope:{variableTypeName:{angularJsBind:"@"},variable:{angularJsBind:"=",default:function(e){return e.variable}},variableType:{angularJsBind:"@"}},directiveName:"piwikVariableSelectType",$inject:["$timeout"],events:{"update:modelValue":function(e,t,n,r,a,o,c){n.value=Object(i["clone"])(e),c()}},postCreate:function(e,t){t.$watch("variable",(function(t,n){t!==n&&Object(o["nextTick"])((function(){e.modelValue=Object(i["clone"])(t)}))}))}})}})}));
//# sourceMappingURL=TagManager.umd.min.js.map