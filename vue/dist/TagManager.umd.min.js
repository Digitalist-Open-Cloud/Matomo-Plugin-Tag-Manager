(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="plugins/TagManager/vue/dist/",a(a.s="fae3")}({"19dc":function(t,a){t.exports=e},"8bbf":function(e,a){e.exports=t},a5a2:function(e,t){e.exports=a},fae3:function(e,t,a){"use strict";if(a.r(t),a.d(t,"ImportVersion",(function(){return f})),a.d(t,"VariableSelect",(function(){return $})),a.d(t,"VariableSelectType",(function(){return te})),a.d(t,"FieldTextareaVariable",(function(){return ta})),a.d(t,"FieldVariableTemplate",(function(){return da})),a.d(t,"FieldVariableTypeTemplate",(function(){return ma})),a.d(t,"VariableEdit",(function(){return Qe})),a.d(t,"VariableList",(function(){return Ht})),a.d(t,"VariableManage",(function(){return Rt})),"undefined"!==typeof window){var n=window.document.currentScript,i=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(a.p=i[1])}var r=a("19dc"),o=a("8bbf"),l={class:"tagManagerImportVersion"},c={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},s=["value"],d=["value"];function u(e,t,a,n,i,r){var u=Object(o["resolveComponent"])("ActivityIndicator"),b=Object(o["resolveComponent"])("Field"),p=Object(o["resolveComponent"])("SaveButton"),m=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",l,[Object(o["createVNode"])(m,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(o["createVNode"])(u,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(b,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.backupName=t}),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(b,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.importContent=t}),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(o["createVNode"])(p,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=function(t){return e.importVersion(e.backupName,e.importContent)}),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,s),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,d)],512)])}var b=a("a5a2"),p="importContainerVersion",m=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:r["ContentBlock"],ActivityIndicator:r["ActivityIndicator"],Field:b["Field"],SaveButton:b["SaveButton"]},data:function(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,type:"transient",id:p});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},importVersion:function(e,t){var a=this;if(t){var n;try{n=JSON.parse(t)}catch(i){return void this.showNotification(Object(r["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in n&&"triggers"in n&&"variables"in n&&"idcontainer"in n&&"context"in n?r["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:function(){a.isUpdating=!0;var e={exportedContainerVersion:t};r["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:a.idContainer,backupName:a.backupName},e).then((function(){a.showNotification(Object(r["translate"])("TagManager_VersionImportSuccess"),"success"),a.isUpdating=!1,window.location.reload()})).catch((function(){a.isUpdating=!1}))}}):this.showNotification(Object(r["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}}},computed:{backupNameTitle:function(){return"".concat(Object(r["translate"])("TagManager_BackupVersionName")," (").concat(Object(r["translate"])("General_Recommended"),")")}}});m.render=u;var f=m,v=(Object(r["createAngularJsAdapter"])({component:f,scope:{idContainer:{angularJsBind:"="}},directiveName:"piwikImportVersion"}),{class:"tagManagerManageSelect tagManagerVariableSelect"}),g={class:"tableActionBar"},h=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),V={class:"collection with-header"},j={class:"collection-header"},O=["onClick"],y={class:"title"},C={class:"secondary-content"},N=["onClick","title"],T={class:"collection-header"},w=["onClick"],S={class:"title"},k={class:"secondary-content"},E=["title"],M={class:"tableActionBar"},_=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function A(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ActivityIndicator");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",v,[Object(o["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(o["createElementVNode"])("div",g,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},[h,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])]),Object(o["createElementVNode"])("ul",V,[Object(o["createElementVNode"])("li",j,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",onClick:function(a){return e.selectVariable(t)},key:a},[Object(o["createElementVNode"])("span",y,Object(o["toDisplayString"])(t.name)+" ("+Object(o["toDisplayString"])(e.translate("TagManager_Type"))+": "+Object(o["toDisplayString"])(t.type)+") ",1),Object(o["createElementVNode"])("span",C,[Object(o["createElementVNode"])("i",{class:"icon-edit",onClick:Object(o["withModifiers"])((function(a){return e.editVariable(t)}),["stop"]),title:e.translate("General_Edit")},null,8,N)])],8,O)})),128))]),Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.preconfiguredVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(o["createElementVNode"])("li",T,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:a,onClick:function(a){return e.selectVariable(t)}},[Object(o["createElementVNode"])("span",S,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",k,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,E)],512),[[o["vShow"],!!t.description]])],8,w)),[[o["vShow"],t.is_pre_configured]])})),128))])})),128)),Object(o["createElementVNode"])("div",M,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[_,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])])])}function D(e){return L(e)||x(e)||U(e)||B()}function B(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function U(e,t){if(e){if("string"===typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}function x(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function L(e){if(Array.isArray(e))return I(e)}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var P=window,H=P.tagManagerHelper,F=Object(o["defineComponent"])({props:{idContainer:{type:[String,Number],required:!0},idContainerVersion:[String,Number]},components:{ActivityIndicator:r["ActivityIndicator"]},data:function(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created:function(){this.fetchAvailableVariables()},watch:{idContainerVersion:function(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables:function(){var e=this;this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.actualIdContainerVersion=t.draft.idcontainerversion,r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:e.idContainer,idContainerVersion:e.actualIdContainerVersion}).then((function(t){e.preconfiguredVariables=[],e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var a,n=Object.assign(Object.assign({},t),{},{types:t.types.filter((function(e){return e.is_pre_configured}))});(a=e.containerVariables).push.apply(a,D(t.types.filter((function(e){return!e.is_pre_configured})))),n.types.length&&e.preconfiguredVariables.push(n)}))})).catch((function(){e.isLoading=!1}))}))},editVariable:function(e){var t=this;this.actualIdContainerVersion&&H.editVariable(null,this.idContainer,this.actualIdContainerVersion,e.idvariable,(function(){t.fetchAvailableVariables()}))},createVariable:function(){var e=this;this.actualIdContainerVersion&&H.editVariable(null,this.idContainer,this.actualIdContainerVersion,0,(function(){e.fetchAvailableVariables()}))},selectVariable:function(e){this.$emit("selectVariable",{variable:e})},fetchContainer:function(){return this.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});F.render=A;var $=F,q=(Object(r["createAngularJsAdapter"])({component:$,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},onSelectVariable:{angularJsBind:"&?",vue:"selectVariable"}},directiveName:"piwikVariableSelect"}),{class:"tagManagerManageSelect tagManagerVariableSelectType"}),J=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function G(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",q,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"select",name:"variableType".concat(e.variableType),class:"selectVariableType","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.onChange(t)}),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(o["withModifiers"])((function(t){return e.createVariable()}),["prevent"]))},[J,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.variableTypeName)),1)],512),[[o["vShow"],!e.isLoading]])])}function R(e){return W(e)||X(e)||K(e)||z()}function z(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function K(e,t){if(e){if("string"===typeof e)return Y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Y(e,t):void 0}}function X(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function W(e){if(Array.isArray(e))return Y(e)}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Q=window,Z=Q.tagManagerHelper,ee=Object(o["defineComponent"])({props:{variableTypeName:{type:String,required:!0},modelValue:String,variableType:String},components:{Field:b["Field"]},emits:["update:modelValue"],data:function(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created:function(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables:function(){var e=this;this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.idContainerVersion=t.draft.idcontainerversion,r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:r["MatomoUrl"].parsed.value.idContainer,idContainerVersion:e.idContainerVersion}).then((function(t){e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var a,n=t.types.filter((function(t){return t.type===e.variableType})).map((function(e){return{key:"{{".concat(e.id,"}}"),value:e.name}}));(a=e.containerVariables).push.apply(a,R(n))})),e.modelValue||1!==e.containerVariables.length||e.onChange(e.containerVariables[0].key)})).catch((function(){e.isLoading=!1}))}))},onChange:function(e){this.$emit("update:modelValue",e)},createVariable:function(){var e=this;this.idContainerVersion&&Z.editVariable(null,r["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,(function(t){e.fetchAvailableVariables(),t&&e.onChange("{{".concat(t.name,"}}"))}),this.variableType)},fetchContainer:function(){return this.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:r["MatomoUrl"].parsed.value.idContainer})}}});ee.render=G;var te=ee;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(r["createAngularJsAdapter"])({component:te,scope:{variableTypeName:{angularJsBind:"@"},variable:{angularJsBind:"=",vue:"modelValue",default:function(e){return e.variable}},variableType:{angularJsBind:"@"}},directiveName:"piwikVariableSelectType",$inject:["$timeout"],events:{"update:modelValue":function(e,t,a,n,i,o,l){a.value=Object(r["clone"])(e),l()}},postCreate:function(e,t){t.$watch("variable",(function(t,a){t!==a&&Object(o["nextTick"])((function(){e.modelValue=Object(r["clone"])(t)}))}))}});function ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ne={class:"editVariable tagManagerManageEdit",ref:"root"},ie={class:"loadingPiwik"},re=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),oe={class:"loadingPiwik"},le=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ce={key:0,class:"form-group row"},se={class:"col s12"},de={key:1},ue={class:"form-group row"},be={class:"col s12"},pe={class:"form-group row"},me={class:"col s12 m12"},fe={for:"lookup_table"},ve=["onClick","title"],ge={class:"entityCancel"},he={id:"confirmSelectVariableType"},Ve={class:"collection-header"},je=["onClick","title"],Oe=["src"],ye={class:"title"},Ce={class:"secondary-content"},Ne=["title"],Te={class:"entityCancel"};function we(e,t,a,n,i,r){var l=this,c=Object(o["resolveComponent"])("Field"),s=Object(o["resolveComponent"])("GroupedSettings"),d=Object(o["resolveComponent"])("SaveButton"),u=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ne,[Object(o["createVNode"])(u,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(o["withCtx"])((function(){var a,n,i,r,u;return[Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",ie,[re,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[o["vShow"],e.isLoading]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",oe,[le,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[o["vShow"],e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("form",{onSubmit:t[8]||(t[8]=function(t){return e.edit?e.updateVariable():e.createVariable()})},[Object(o["createElementVNode"])("div",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isVariableDisabled]]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"type",modelValue:e.variable.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.variable.name=t}),disabled:!0,"inline-help":e.typeInlineHelp,title:e.translate("TagManager_Type")},null,8,["modelValue","inline-help","title"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"name","model-value":e.variable.name,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.variable.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_VariableNameHelp")},null,8,["model-value","title","inline-help"])]),null!==(a=e.variable.typeMetadata)&&void 0!==a&&null!==(n=a.parameters)&&void 0!==n&&n.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ce,[Object(o["createElementVNode"])("div",se,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureThisVariable")),1)])])):Object(o["createCommentVNode"])("",!0),e.variable?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",de,[Object(o["createVNode"])(s,{settings:(null===(i=e.variable.typeMetadata)||void 0===i?void 0:i.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ue,[Object(o["createElementVNode"])("div",be,[Object(o["createElementVNode"])("h3",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"showAdvancedSettings",onClick:t[3]||(t[3]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!0}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[o["vShow"],!e.showAdvanced]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"hideAdvancedSettings",onClick:t[4]||(t[4]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!1}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[o["vShow"],e.showAdvanced]])])])],512),[[o["vShow"],null===(r=e.variable.typeMetadata)||void 0===r?void 0:r.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"default_value",class:"innerFormField","model-value":e.variable.default_value,"onUpdate:modelValue":t[5]||(t[5]=function(t){e.variable.default_value=t,e.setValueHasChanged()}),title:e.translate("TagManager_DefaultValue"),"inline-help":e.translate("TagManager_DefaultValueHelp")},null,8,["model-value","title","inline-help"])]),Object(o["createElementVNode"])("div",pe,[Object(o["createElementVNode"])("div",me,[Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("label",fe,Object(o["toDisplayString"])(e.translate("TagManager_LookupTableTitle")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.variable.lookup_table,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:a,class:Object(o["normalizeClass"])("lookupTable lookupTable".concat(a," multiple valign-wrapper"))},[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"select",name:"lookup_table_comparison",class:"innerFormField comparisonField","model-value":t.comparison,"onUpdate:modelValue":function(a){t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableLookUpComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"lookup_table_matchvalue",class:"innerFormField","model-value":t.match_value,"onUpdate:modelValue":function(a){t.match_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableMatchValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"lookup_table_outvalue",class:"innerFormField","model-value":t.out_value,"onUpdate:modelValue":function(a){t.out_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableOutValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),a+1!==e.variable.lookup_table.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:"icon-minus valign",onClick:function(t){return e.removeLookUpEntry(a)},title:e.translate("General_Remove")},null,8,ve)):Object(o["createCommentVNode"])("",!0)],2)})),128))])])])],512),[[o["vShow"],e.showAdvanced&&(null===(u=e.variable.typeMetadata)||void 0===u?void 0:u.hasAdvancedSettings)]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isVariableDisabled]]),Object(o["withDirectives"])(Object(o["createVNode"])(d,{class:"createButton",onConfirm:t[6]||(t[6]=function(t){return e.edit?e.updateVariable():e.createVariable()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewVariable")},null,8,["disabled","saving","value"]),[[o["vShow"],!e.isVariableDisabled]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ge,[Object(o["createElementVNode"])("a",{onClick:t[7]||(t[7]=Object(o["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])])],544),[[o["vShow"],!e.chooseVariableType&&e.editTitle]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",he,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.availableVariables,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(o["createElementVNode"])("li",Ve,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{key:a,class:Object(o["normalizeClass"])(["collection-item avatar",ae({disabledTemplate:l.isVariableTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(a){return e.createVariableType(t)},title:l.isVariableTemplateDisabled[t.id]?e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates")):""},[t.icon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,Oe)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",ye,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.description),513),[[o["vShow"],t.description]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",Ce,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Ne)],512),[[o["vShow"],!!t.help]])],10,je)})),128))])})),128)),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Te,[Object(o["createElementVNode"])("a",{onClick:t[9]||(t[9]=Object(o["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])],512),[[o["vShow"],e.chooseVariableType]])]})),_:1},8,["content-title"])],512)}function Se(e,t){return Me(e)||Ee(e,t)||Be(e,t)||ke()}function ke(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ee(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function Me(e){if(Array.isArray(e))return e}function _e(e){return _e="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function Ae(e){return xe(e)||Ue(e)||Be(e)||De()}function De(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Be(e,t){if(e){if("string"===typeof e)return Le(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Le(e,t):void 0}}function Ue(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function xe(e){if(Array.isArray(e))return Le(e)}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function He(e,t,a){return t&&Pe(e.prototype,t),a&&Pe(e,a),e}function Fe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var $e=function(){function e(){var t=this;Ie(this,e),Fe(this,"privateState",Object(o["reactive"])({variables:[],isLoadingVars:!1,isLoadingSingle:!1,isUpdating:!1})),Fe(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Fe(this,"isLoading",Object(o["computed"])((function(){var e=t.state.value;return e.isLoadingVars||e.isLoadingSingle}))),Fe(this,"isUpdating",Object(o["computed"])((function(){return t.state.value.isUpdating}))),Fe(this,"variables",Object(o["computed"])((function(){return t.state.value.variables}))),Fe(this,"fetchPromise",null),Fe(this,"availableVariablesPromises",{})}return He(e,[{key:"fetchVariablesIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchVariables(e,t)}},{key:"findVariable",value:function(e,t,a){var n=this,i=this.variables.value.find((function(e){return e.idvariable===a}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,r["AjaxHelper"].fetch({idVariable:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerVariable",filter_limit:"-1"}).then((function(e){return n.privateState.variables=[].concat(Ae(n.privateState.variables),[e]),Object(o["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"fetchVariables",value:function(e,t){var a=this;return this.privateState.isLoadingVars=!0,this.privateState.variables=[],this.fetchPromise||(this.fetchPromise=r["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return a.privateState.variables=e,a.privateState.isLoadingVars=!1,a.variables.value})).finally((function(){a.privateState.isLoadingVars=!1}))}},{key:"fetchAvailableVariables",value:function(e){return this.availableVariablesPromises[e]||(this.availableVariablesPromises[e]=r["AjaxHelper"].fetch({method:"TagManager.getAvailableVariableTypesInContext",idContext:e,filter_limit:"-1"}).then((function(e){return Object(o["readonly"])(e)}))),Promise.resolve(this.availableVariablesPromises[e])}},{key:"suggestNameForType",value:function(e){for(var t=this,a=function(a){var n=e;a&&(n="".concat(n," (").concat(a,")"));var i=!t.variables.value.some((function(e){return e.name===n}));if(i)return{v:n}},n=0;n<100;n+=1){var i=a(n);if("object"===_e(i))return i.v}}},{key:"createOrUpdateVariable",value:function(e,t,a,n,i){var o=this;this.privateState.isUpdating=!0;var l=Object.entries(i).map((function(e){var t=Se(e,2),a=t[0],n=t[1],i=n;return"boolean"===typeof n&&(i=(+n).toString()),[a,i]})),c=Object.fromEntries(l),s=e.lookup_table.filter((function(e){return e&&e.out_value&&e.comparison}));return r["AjaxHelper"].post({idVariable:e.idvariable,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,defaultValue:e.default_value},{parameters:c,lookupTable:s},{withTokenInUrl:!0}).finally((function(){o.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.variables=[],this.fetchPromise=null,this.availableVariablesPromises={},this.fetchVariables(e,t)}},{key:"deleteVariable",value:function(e,t,a){var n=this;return this.privateState.isUpdating=!0,this.privateState.variables=[],r["AjaxHelper"].fetch({idVariable:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVariable"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}}]),e}(),qe=new $e;function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ge(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Re(e,t,a){return t&&Ge(e.prototype,t),a&&Ge(e,a),e}function ze(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Ke=function(){function e(){var t=this;Je(this,e),ze(this,"privateState",Object(o["reactive"])({comparisons:[],isLoading:!1})),ze(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),ze(this,"isLoading",Object(o["computed"])((function(){return t.state.value.isLoading}))),ze(this,"comparisons",Object(o["computed"])((function(){return t.state.value.comparisons}))),ze(this,"comparisonOptions",Object(o["computed"])((function(){return t.comparisons.value.map((function(e){var t=e.id,a=e.name;return{key:t,value:a}}))}))),this.fetchAvailableComparisons()}return Re(e,[{key:"fetchAvailableComparisons",value:function(){var e=this;this.privateState.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getAvailableComparisons",filter_limit:"-1"}).then((function(t){e.privateState.comparisons=t})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Xe=Object(r["lazyInitSingleton"])(Ke),We="tagvariablemanagement",Ye=Object(o["defineComponent"])({props:{idVariable:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variableType:String,isEmbedded:{type:Boolean,default:!1}},components:{GroupedSettings:b["GroupedSettings"],ContentBlock:r["ContentBlock"],Field:b["Field"],SaveButton:b["SaveButton"]},data:function(){return{isDirty:!1,showAdvanced:!1,chooseVariableType:!1,canUseCustomTemplates:r["Matomo"].hasUserCapability("tagmanager_use_custom_templates"),availableVariables:[],editTitle:"",variable:{},parameterValues:{},isUpdatingVar:!1}},emits:["changeVariable"],created:function(){qe.fetchVariablesIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdVariable()},watch:{idVariable:function(e){null!==e&&this.initIdVariable()},variableParameterValues:{handler:function(e){e&&(this.isDirty=!0)},deep:!0},variableLookupTable:{handler:function(){var e=(this.variable.lookup_table||[]).every((function(e){return!(null===e||void 0===e||!e.out_value)}));e&&this.addLookUpEntry()},deep:!0}},methods:{removeAnyVariableNotification:function(){r["NotificationsStore"].remove(We),r["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,id:We,type:"transient"});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(r["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdVariable:function(){var e=this;r["Matomo"].helper.lazyScrollToContent(),this.availableVariables=[],r["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return qe.fetchAvailableVariables(e.context)})).then((function(t){e.availableVariables=t})).then((function(){if(e.edit&&e.idVariable)return e.editTitle=Object(r["translate"])("TagManager_EditVariable"),void qe.findVariable(e.idContainer,e.idContainerVersion,e.idVariable).then((function(t){t&&(e.variable=Object(r["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),(e.variable.lookup_table&&e.variable.lookup_table.length||e.variable.default_value)&&(e.showAdvanced=!0),e.addLookUpEntryIfNoneExists(),e.isDirty=!1)}));if(e.create){var t=!1;e.variableType&&e.availableVariables.forEach((function(a){t||(t=a.types.some((function(t){return(null===t||void 0===t?void 0:t.id)===e.variableType})))})),t||(e.editTitle=Object(r["translate"])("TagManager_ChooseVariableToContinue"),e.chooseVariableType=!0)}}))},addLookUpEntryIfNoneExists:function(){this.variable.lookup_table&&Array.isArray(this.variable.lookup_table)||(this.variable.lookup_table=[]),this.variable.lookup_table.length||this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""})},addLookUpEntry:function(){this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""}),this.isDirty=!0},removeLookUpEntry:function(e){e>-1&&(this.variable.lookup_table.splice(e,1),this.isDirty=!0)},createVariableType:function(e){var t=this;e&&this.isVariableTemplateDisabled[e.id]||(this.chooseVariableType=!1,this.editTitle=Object(r["translate"])("TagManager_CreateNewVariable"),this.variable={idsite:parseInt("".concat(r["Matomo"].idSite),10),name:qe.suggestNameForType(e.name)||"",type:e.id,idcontainer:this.idContainer,idcontainerversion:this.idContainerVersion,default_value:"",lookup_table:[],typeMetadata:e},this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addLookUpEntry(),this.isDirty=!0,Object(o["nextTick"])((function(){if(t.$refs.root){var e=t.$refs.root;e.scrollIntoView();var a=e.querySelector("#name");a&&a.focus()}})))},cancel:function(){var e=Object.assign({},r["MatomoUrl"].hashParsed.value);delete e.idVariable,r["MatomoUrl"].updateHash(e)},createVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,qe.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.addContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t){e.isDirty=!1;var a=t.value;qe.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.variable.idvariable=a,void e.$emit("changeVariable",{variable:e.variable});r["Matomo"].helper.isAngularRenderingThePage()?r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idVariable:a})):r["MatomoUrl"].updateHash({idVariable:a}),setTimeout((function(){var t=Object(r["translate"])("TagManager_CreatedX",Object(r["translate"])("TagManager_Variable")),a=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a onclick="tagManagerHelper.createNewVersion()">',"</a>");e.showNotification("".concat(t," ").concat(a),"success")}),200)}))}})).finally((function(){e.isUpdatingVar=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,qe.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.updateContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t)if(e.isEmbedded)e.$emit("changeVariable",{variable:e.variable});else{e.isDirty=!1,qe.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdVariable()}));var a=Object(r["translate"])("TagManager_UpdatedX",Object(r["translate"])("TagManager_Variable")),n=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a onclick="tagManagerHelper.createNewVersion()">',"</a>");e.showNotification("".concat(a," ").concat(n),"success")}})).finally((function(){e.isUpdatingVar=!1})))},checkRequiredFieldsAreSet:function(){return!!this.variable.name||(this.showErrorFieldNotProvidedNotification(Object(r["translate"])("General_Name")),!1)}},computed:{typeInlineHelp:function(){var e,t,a=(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.description)||"",n=(null===(t=this.variable.typeMetadata)||void 0===t?void 0:t.help)||"";return"".concat(a," ").concat(n)},create:function(){return 0===this.idVariable},edit:function(){return!this.create},isLoading:function(){return qe.isLoading.value||Xe.isLoading.value},isUpdating:function(){return qe.isUpdating.value||this.isUpdatingVar},availableLookUpComparisons:function(){return Xe.comparisonOptions.value},isVariableTemplateDisabled:function(){var e=this,t={};return this.availableVariables.forEach((function(a){a.types.forEach((function(a){t[a.id]=!e.canUseCustomTemplates&&a.isCustomTemplate}))})),t},isVariableDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},variableParameterValues:function(){var e;return null!==(e=this.variable.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null},variableLookupTable:function(){return this.variable.lookup_table}}});Ye.render=we;var Qe=Ye,Ze=(Object(r["createAngularJsAdapter"])({component:Qe,scope:{idVariable:{angularJsBind:"="},idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},variableType:{angularJsBind:"=?"},isEmbedded:{default:function(e){return!!e.onChangeVariable}},onChangeVariable:{angularJsBind:"&?",vue:"changeVariable"}},directiveName:"piwikVariableEdit",events:{onChangeVariable:function(e,t,a){a.idVariable=e.variable.idvariable}},postCreate:function(e,t){t.$on("$destroy",(function(){t.idVariable=null}))}}),{class:"tagManagerManageList tagManagerVariableList"}),et={class:"name"},tt={class:"type"},at={class:"lookupTable"},nt={class:"lastUpdated"},it={colspan:"7"},rt={class:"loadingPiwik"},ot=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),lt={colspan:"7"},ct=["id"],st={class:"name"},dt=["title"],ut={class:"lookupTable"},bt={class:"icon-ok"},pt=["title"],mt={class:"action"},ft=["onClick","title"],vt=["onClick","title"],gt={class:"tableActionBar"},ht=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),Vt=["title"],jt=Object(o["createElementVNode"])("span",{class:"icon-help preconfiguredVariablesHelp"},null,-1),Ot={class:"collection-header"},yt={class:"title"},Ct=["textContent"],Nt={class:"secondary-content"},Tt=["title"],wt={class:"ui-confirm",id:"confirmDeleteVariable",ref:"confirmDeleteVariable"},St=["value"],kt=["value"],Et={class:"ui-confirm",id:"confirmDeleteVariableNotPossible",ref:"confirmDeleteVariableNotPossible"},Mt={class:"collection"},_t=["value"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function At(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ContentBlock"),c=Object(o["resolveDirective"])("content-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Ze,[Object(o["createVNode"])(l,{feature:"Tag Manager",class:"tagManagerCustomVariablesList","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Variables"))},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableUsageBenefits")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("table",null,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",et,Object(o["toDisplayString"])(e.translate("General_Name")),1),Object(o["createElementVNode"])("th",tt,Object(o["toDisplayString"])(e.translate("TagManager_Type")),1),Object(o["createElementVNode"])("th",at,Object(o["toDisplayString"])(e.translate("TagManager_LookupTable")),1),Object(o["createElementVNode"])("th",nt,Object(o["toDisplayString"])(e.translate("TagManager_LastUpdated")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("th",{class:"action"},Object(o["toDisplayString"])(e.translate("General_Actions")),513),[[o["vShow"],e.hasWriteAccess]])])]),Object(o["createElementVNode"])("tbody",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",it,[Object(o["createElementVNode"])("span",rt,[ot,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[o["vShow"],e.isLoading||e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",lt,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_NoVariablesFound"))+" ",1),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createContainerVariableNow",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewVariableNow")),513),[[o["vShow"],e.hasWriteAccess]])])],512),[[o["vShow"],!e.isLoading&&!e.variables.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sortedVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{id:"variable".concat(t.idvariable),class:"variables",key:t.idvariable},[Object(o["createElementVNode"])("td",st,Object(o["toDisplayString"])(t.name),1),Object(o["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(o["toDisplayString"])(t.typeMetadata.name),9,dt),Object(o["createElementVNode"])("td",ut,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",bt,null,512),[[o["vShow"],t.lookup_table.length]])]),Object(o["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.updated_date_pretty),1)],8,pt),Object(o["withDirectives"])(Object(o["createElementVNode"])("td",mt,[Object(o["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(a){return e.editVariable(t.idvariable,t.type)},title:e.translate("TagManager_EditVariable")},null,8,ft),Object(o["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(a){return e.deleteVariable(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Variable"))},null,8,vt)],512),[[o["vShow"],e.hasWriteAccess]])],8,ct)})),128))])],512),[[c]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",gt,[Object(o["createElementVNode"])("a",{class:"createNewVariable",value:"",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[ht,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)])],512),[[o["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("h2",{title:e.translate("TagManager_PreConfiguredInfoTitle")},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables"))+" ",1),jt],8,Vt),Object(o["createElementVNode"])("div",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(e,t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t},[Object(o["createElementVNode"])("li",Ot,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.types,(function(e){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:e.id},[Object(o["createElementVNode"])("span",yt,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.name)+" ",1),Object(o["createElementVNode"])("span",{class:"variableId",textContent:Object(o["toDisplayString"])("{{".concat(e.id,"}}"))},null,8,Ct)]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",Nt,[Object(o["createElementVNode"])("i",{class:"icon-help",title:e.description},null,8,Tt)],512),[[o["vShow"],!!e.description]])],512)),[[o["vShow"],e.is_pre_configured]])})),128))])})),128))]),Object(o["createElementVNode"])("div",wt,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_DeleteVariableConfirm")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,St),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,kt)],512),Object(o["createElementVNode"])("div",Et,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableCannotBeDeleted")),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableBeingUsedBy")),1),Object(o["createElementVNode"])("ul",Mt,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.variableReferences,(function(e){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:"".concat(e.referenceType,".").concat(e.referenceId)},Object(o["toDisplayString"])(e.referenceTypeName)+": "+Object(o["toDisplayString"])(e.referenceName),1)})),128))]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableBeingUsedNeedsRemove")),1),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,_t)],512)])}function Dt(e){return Lt(e)||xt(e)||Ut(e)||Bt()}function Bt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ut(e,t){if(e){if("string"===typeof e)return It(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?It(e,t):void 0}}function xt(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Lt(e){if(Array.isArray(e))return It(e)}function It(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Pt=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0}},components:{ContentBlock:r["ContentBlock"]},directives:{ContentTable:r["ContentTable"]},data:function(){return{hasWriteAccess:r["Matomo"].hasUserCapability("tagmanager_write"),variableReferences:[],containerVariables:[]}},created:function(){var e=this;qe.fetchVariables(this.idContainer,this.idContainerVersion),r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then((function(t){e.containerVariables=t}))},methods:{createVariable:function(){this.editVariable(0)},editVariable:function(e){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idVariable:e}))},deleteVariable:function(e){var t=this;r["AjaxHelper"].fetch({method:"TagManager.getContainerVariableReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idVariable:e.idvariable}).then((function(a){a&&a.length?(t.variableReferences=a,r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariableNotPossible,{})):(t.variableReferences=[],r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariable,{yes:function(){qe.deleteVariable(t.idContainer,t.idContainerVersion,e.idvariable).then((function(){qe.reload(t.idContainer,t.idContainerVersion)}))}}))}))}},computed:{isLoading:function(){return qe.isLoading.value},isUpdating:function(){return qe.isUpdating.value},variables:function(){return qe.variables.value},sortedVariables:function(){var e=Dt(this.variables);return e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),e}}});Pt.render=At;var Ht=Pt,Ft=(Object(r["createAngularJsAdapter"])({component:Ht,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="}},directiveName:"piwikVariableList"}),{class:"manageVariable"}),$t={key:0},qt={key:1};
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Jt(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("VariableList"),c=Object(o["resolveComponent"])("VariableEdit");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Ft,[e.editMode?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",$t,[Object(o["createVNode"])(l,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer},null,8,["id-container-version","id-container"])])),e.editMode?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",qt,[Object(o["createVNode"])(c,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"id-variable":e.idVariable},null,8,["id-container-version","id-container","id-variable"])])):Object(o["createCommentVNode"])("",!0)])}var Gt=Object(o["defineComponent"])({props:{idContainerVersion:Number,idContainer:String},components:{VariableList:Ht,VariableEdit:Qe},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(o["watch"])((function(){return r["MatomoUrl"].hashParsed.value.idVariable}),(function(t){e.onIdVariableParamChange(t)})),r["NotificationsStore"].remove("variablevariablemanagement"),this.onIdVariableParamChange(r["MatomoUrl"].hashParsed.value.idVariable)},methods:{onIdVariableParamChange:function(e){if("0"===e){var t={isAllowed:!0};r["Matomo"].postEvent("TagManager.initAddVariable",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idVariable:function(){var e=r["MatomoUrl"].hashParsed.value.idVariable;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idVariable}}});Gt.render=Jt;var Rt=Gt,zt=(Object(r["createAngularJsAdapter"])({component:Rt,scope:{idContainerVersion:{angularJsBind:"@",transform:function(e){return e?parseInt(e,10):void 0}},idContainer:{angularJsBind:"@"}},directiveName:"piwikVariableManage"}),{class:"fieldVariableTemplate"}),Kt=["type","id","name","value"],Xt=["title"],Wt=["for","innerHTML"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Yt(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",zt,[Object(o["createElementVNode"])("textarea",Object(o["mergeProps"])({class:"control_".concat(e.uiControl," materialize-textarea"),type:e.uiControl,id:e.name,name:e.name,value:e.modelValue,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"textarea"}),null,16,Kt),Object(o["createElementVNode"])("span",{class:"icon-code",style:{"margin-top":"14px",position:"absolute"},title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,Xt),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,Wt)])}var Qt=window,Zt=Qt.tagManagerHelper,ea=Object(o["defineComponent"])({props:{name:String,uiControlAttributes:Object,modelValue:String,title:String,uiControl:{type:String,required:!0}},inheritAttrs:!1,emits:["update:modelValue"],created:function(){this.onKeydown=Object(r["debounce"])(this.onKeydown.bind(this),50)},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;Zt.selectVariable((function(t){Zt.insertTextSnippetAtElement(e.$refs.textarea,"{{".concat(t.id,"}}"))}))}},watch:{modelValue:function(){var e=this,t=window,a=t.Materialize;setTimeout((function(){a.textareaAutoResize(e.$refs.textarea),a.updateTextFields()}))}},mounted:function(){var e=this,t=window,a=t.Materialize;setTimeout((function(){a.textareaAutoResize(e.$refs.textarea),a.updateTextFields()}))}});ea.render=Yt;var ta=ea,aa={class:"fieldVariableTemplate"},na=["type","id","name","value"],ia=["title"],ra=["for","innerHTML"];function oa(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",aa,[Object(o["createElementVNode"])("input",Object(o["mergeProps"])({class:"control_".concat(e.uiControl),type:e.uiControl,id:e.name,name:e.name,value:e.modelValueText,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"input"}),null,16,na),Object(o["createElementVNode"])("span",{class:"icon-code",title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,ia),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,ra)])}var la=window,ca=la.tagManagerHelper,sa=Object(o["defineComponent"])({props:{uiControl:{type:String,required:!0},uiControlAttributes:Object,name:String,title:String,modelValue:null},inheritAttrs:!1,emits:["update:modelValue"],computed:{modelValueText:function(){return"undefined"===typeof this.modelValue||null===this.modelValue?"":this.modelValue.toString()}},created:function(){this.onKeydown=Object(r["debounce"])(this.onKeydown.bind(this),50)},mounted:function(){setTimeout((function(){window.Materialize.updateTextFields()}))},watch:{modelValue:function(){setTimeout((function(){window.Materialize.updateTextFields()}))}},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;ca.selectVariable((function(t){ca.insertTextSnippetAtElement(e.$refs.input,"{{".concat(t.id,"}}"))}))}}});sa.render=oa;var da=sa,ua=["for","innerHTML"];function ba(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("VariableSelectType");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createVNode"])(l,{"model-value":e.modelValue,id:e.name,name:e.name,"variable-type-name":e.title,"variable-type":e.uiControlAttributes.variableType,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t)})},null,8,["model-value","id","name","variable-type-name","variable-type"]),Object(o["createElementVNode"])("label",{for:e.name,style:{"font-size":"0.8rem"},innerHTML:e.$sanitize(e.title)},null,8,ua)])}var pa=Object(o["defineComponent"])({props:{uiControlAttributes:{type:Object,required:!0},name:String,title:String,modelValue:String},components:{VariableSelectType:te},emits:["update:modelValue"]});pa.render=ba;var ma=pa;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=TagManager.umd.min.js.map