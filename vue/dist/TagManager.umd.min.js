(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="plugins/TagManager/vue/dist/",a(a.s="fae3")}({"19dc":function(t,a){t.exports=e},"8bbf":function(e,a){e.exports=t},a5a2:function(e,t){e.exports=a},fae3:function(e,t,a){"use strict";if(a.r(t),a.d(t,"ImportVersion",(function(){return p})),a.d(t,"VariableSelect",(function(){return $})),a.d(t,"VariableSelectType",(function(){return te})),a.d(t,"FieldTextareaVariable",(function(){return Fn})),a.d(t,"FieldVariableTemplate",(function(){return Xn})),a.d(t,"FieldVariableTypeTemplate",(function(){return Zn})),a.d(t,"VariableEdit",(function(){return at})),a.d(t,"VariableList",(function(){return Jt})),a.d(t,"VariableManage",(function(){return Kt})),a.d(t,"TriggerEdit",(function(){return Ga})),a.d(t,"TriggerList",(function(){return Sn})),a.d(t,"TriggerManage",(function(){return _n})),"undefined"!==typeof window){var n=window.document.currentScript,i=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(a.p=i[1])}var r=a("19dc"),o=a("8bbf"),l={class:"tagManagerImportVersion"},c={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},s=["value"],d=["value"];function u(e,t,a,n,i,r){var u=Object(o["resolveComponent"])("ActivityIndicator"),g=Object(o["resolveComponent"])("Field"),b=Object(o["resolveComponent"])("SaveButton"),m=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",l,[Object(o["createVNode"])(m,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(o["createVNode"])(u,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(g,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.backupName=t}),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(g,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.importContent=t}),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(o["createVNode"])(b,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=function(t){return e.importVersion(e.backupName,e.importContent)}),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,s),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,d)],512)])}var g=a("a5a2"),b="importContainerVersion",m=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:r["ContentBlock"],ActivityIndicator:r["ActivityIndicator"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,type:"transient",id:b});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},importVersion:function(e,t){var a=this;if(t){var n;try{n=JSON.parse(t)}catch(i){return void this.showNotification(Object(r["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in n&&"triggers"in n&&"variables"in n&&"idcontainer"in n&&"context"in n?r["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:function(){a.isUpdating=!0;var e={exportedContainerVersion:t};r["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:a.idContainer,backupName:a.backupName},e).then((function(){a.showNotification(Object(r["translate"])("TagManager_VersionImportSuccess"),"success"),a.isUpdating=!1,window.location.reload()})).catch((function(){a.isUpdating=!1}))}}):this.showNotification(Object(r["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}}},computed:{backupNameTitle:function(){return"".concat(Object(r["translate"])("TagManager_BackupVersionName")," (").concat(Object(r["translate"])("General_Recommended"),")")}}});m.render=u;var p=m,f=(Object(r["createAngularJsAdapter"])({component:p,scope:{idContainer:{angularJsBind:"="}},directiveName:"piwikImportVersion"}),{class:"tagManagerManageSelect tagManagerVariableSelect"}),v={class:"tableActionBar"},h=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),j={class:"collection with-header"},O={class:"collection-header"},V=["onClick"],y={class:"title"},T={class:"secondary-content"},C=["onClick","title"],N={class:"collection-header"},E=["onClick"],S={class:"title"},w={class:"secondary-content"},k=["title"],M={class:"tableActionBar"},_=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function D(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ActivityIndicator");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",f,[Object(o["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(o["createElementVNode"])("div",v,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},[h,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])]),Object(o["createElementVNode"])("ul",j,[Object(o["createElementVNode"])("li",O,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",onClick:function(a){return e.selectVariable(t)},key:a},[Object(o["createElementVNode"])("span",y,Object(o["toDisplayString"])(t.name)+" ("+Object(o["toDisplayString"])(e.translate("TagManager_Type"))+": "+Object(o["toDisplayString"])(t.type)+") ",1),Object(o["createElementVNode"])("span",T,[Object(o["createElementVNode"])("i",{class:"icon-edit",onClick:Object(o["withModifiers"])((function(a){return e.editVariable(t)}),["stop"]),title:e.translate("General_Edit")},null,8,C)])],8,V)})),128))]),Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.preconfiguredVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(o["createElementVNode"])("li",N,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:a,onClick:function(a){return e.selectVariable(t)}},[Object(o["createElementVNode"])("span",S,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",w,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,k)],512),[[o["vShow"],!!t.description]])],8,E)),[[o["vShow"],t.is_pre_configured]])})),128))])})),128)),Object(o["createElementVNode"])("div",M,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[_,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])])])}function A(e){return L(e)||x(e)||U(e)||B()}function B(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function U(e,t){if(e){if("string"===typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}function x(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function L(e){if(Array.isArray(e))return I(e)}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var P=window,F=P.tagManagerHelper,H=Object(o["defineComponent"])({props:{idContainer:{type:[String,Number],required:!0},idContainerVersion:[String,Number]},components:{ActivityIndicator:r["ActivityIndicator"]},data:function(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created:function(){this.fetchAvailableVariables()},watch:{idContainerVersion:function(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables:function(){var e=this;this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.actualIdContainerVersion=t.draft.idcontainerversion,r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:e.idContainer,idContainerVersion:e.actualIdContainerVersion}).then((function(t){e.preconfiguredVariables=[],e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var a,n=Object.assign(Object.assign({},t),{},{types:t.types.filter((function(e){return e.is_pre_configured}))});(a=e.containerVariables).push.apply(a,A(t.types.filter((function(e){return!e.is_pre_configured})))),n.types.length&&e.preconfiguredVariables.push(n)}))})).catch((function(){e.isLoading=!1}))}))},editVariable:function(e){var t=this;this.actualIdContainerVersion&&F.editVariable(null,this.idContainer,this.actualIdContainerVersion,e.idvariable,(function(){t.fetchAvailableVariables()}))},createVariable:function(){var e=this;this.actualIdContainerVersion&&F.editVariable(null,this.idContainer,this.actualIdContainerVersion,0,(function(){e.fetchAvailableVariables()}))},selectVariable:function(e){this.$emit("selectVariable",{variable:e})},fetchContainer:function(){return this.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});H.render=D;var $=H,q=(Object(r["createAngularJsAdapter"])({component:$,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},onSelectVariable:{angularJsBind:"&?",vue:"selectVariable"}},directiveName:"piwikVariableSelect"}),{class:"tagManagerManageSelect tagManagerVariableSelectType"}),J=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function G(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",q,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"select",name:"variableType".concat(e.variableType),class:"selectVariableType","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.onChange(t)}),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(o["withModifiers"])((function(t){return e.createVariable()}),["prevent"]))},[J,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.variableTypeName)),1)],512),[[o["vShow"],!e.isLoading]])])}function R(e){return K(e)||X(e)||W(e)||z()}function z(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function W(e,t){if(e){if("string"===typeof e)return Y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Y(e,t):void 0}}function X(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function K(e){if(Array.isArray(e))return Y(e)}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Q=window,Z=Q.tagManagerHelper,ee=Object(o["defineComponent"])({props:{variableTypeName:{type:String,required:!0},modelValue:String,variableType:String},components:{Field:g["Field"]},emits:["update:modelValue"],data:function(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created:function(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables:function(){var e=this;this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.idContainerVersion=t.draft.idcontainerversion,r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:r["MatomoUrl"].parsed.value.idContainer,idContainerVersion:e.idContainerVersion}).then((function(t){e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var a,n=t.types.filter((function(t){return t.type===e.variableType})).map((function(e){return{key:"{{".concat(e.id,"}}"),value:e.name}}));(a=e.containerVariables).push.apply(a,R(n))})),e.modelValue||1!==e.containerVariables.length||e.onChange(e.containerVariables[0].key)})).catch((function(){e.isLoading=!1}))}))},onChange:function(e){this.$emit("update:modelValue",e)},createVariable:function(){var e=this;this.idContainerVersion&&Z.editVariable(null,r["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,(function(t){e.fetchAvailableVariables(),t&&e.onChange("{{".concat(t.name,"}}"))}),this.variableType)},fetchContainer:function(){return this.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:r["MatomoUrl"].parsed.value.idContainer})}}});ee.render=G;var te=ee;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(r["createAngularJsAdapter"])({component:te,scope:{variableTypeName:{angularJsBind:"@"},variable:{angularJsBind:"=",vue:"modelValue",default:function(e){return e.variable}},variableType:{angularJsBind:"@"}},directiveName:"piwikVariableSelectType",$inject:["$timeout"],events:{"update:modelValue":function(e,t,a,n,i,o,l){a.variable=Object(r["clone"])(e),l()}},postCreate:function(e,t){t.$watch("variable",(function(t,a){t!==a&&Object(o["nextTick"])((function(){e.modelValue=Object(r["clone"])(t)}))}))}});function ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ne={class:"editVariable tagManagerManageEdit",ref:"root"},ie={class:"loadingPiwik"},re=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),oe={class:"loadingPiwik"},le=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ce={key:0,class:"form-group row"},se={class:"col s12"},de={key:1},ue={class:"form-group row"},ge={class:"col s12"},be={class:"innerFormField"},me={class:"form-group row"},pe={class:"col s12 m12"},fe={for:"lookup_table"},ve={class:"innerFormField comparisonField"},he={class:"innerFormField"},je={class:"innerFormField"},Oe=["onClick","title"],Ve={class:"entityCancel"},ye={id:"confirmSelectVariableType"},Te={class:"collection-header"},Ce=["onClick","title"],Ne=["src"],Ee={class:"title"},Se={class:"secondary-content"},we=["title"],ke={class:"entityCancel"};function Me(e,t,a,n,i,r){var l=this,c=Object(o["resolveComponent"])("Field"),s=Object(o["resolveComponent"])("GroupedSettings"),d=Object(o["resolveComponent"])("SaveButton"),u=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ne,[Object(o["createVNode"])(u,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(o["withCtx"])((function(){var a,n,i,r,u;return[Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",ie,[re,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[o["vShow"],e.isLoading]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",oe,[le,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[o["vShow"],e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("form",{onSubmit:t[7]||(t[7]=function(t){return e.edit?e.updateVariable():e.createVariable()})},[Object(o["createElementVNode"])("div",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isVariableDisabled]]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"type","model-value":e.variable.name,disabled:!0,"inline-help":e.typeInlineHelp,title:e.translate("TagManager_Type")},null,8,["model-value","inline-help","title"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"name","model-value":e.variable.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.variable.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_VariableNameHelp")},null,8,["model-value","title","inline-help"])]),null!==(a=e.variable.typeMetadata)&&void 0!==a&&null!==(n=a.parameters)&&void 0!==n&&n.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ce,[Object(o["createElementVNode"])("div",se,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureThisVariable")),1)])])):Object(o["createCommentVNode"])("",!0),e.variable?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",de,[Object(o["createVNode"])(s,{settings:(null===(i=e.variable.typeMetadata)||void 0===i?void 0:i.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[1]||(t[1]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ue,[Object(o["createElementVNode"])("div",ge,[Object(o["createElementVNode"])("h3",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"showAdvancedSettings",onClick:t[2]||(t[2]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!0}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[o["vShow"],!e.showAdvanced]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"hideAdvancedSettings",onClick:t[3]||(t[3]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!1}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[o["vShow"],e.showAdvanced]])])])],512),[[o["vShow"],null===(r=e.variable.typeMetadata)||void 0===r?void 0:r.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",be,[Object(o["createVNode"])(c,{uicontrol:"text",name:"default_value","model-value":e.variable.default_value,"onUpdate:modelValue":t[4]||(t[4]=function(t){e.variable.default_value=t,e.setValueHasChanged()}),title:e.translate("TagManager_DefaultValue"),"inline-help":e.translate("TagManager_DefaultValueHelp")},null,8,["model-value","title","inline-help"])]),Object(o["createElementVNode"])("div",me,[Object(o["createElementVNode"])("div",pe,[Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("label",fe,Object(o["toDisplayString"])(e.translate("TagManager_LookupTableTitle")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.variable.lookup_table,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:a,class:Object(o["normalizeClass"])("lookupTable lookupTable".concat(a," multiple valign-wrapper"))},[Object(o["createElementVNode"])("div",ve,[Object(o["createVNode"])(c,{uicontrol:"select",name:"lookup_table_comparison","model-value":t.comparison,"onUpdate:modelValue":function(a){t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableLookUpComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(o["createElementVNode"])("div",he,[Object(o["createVNode"])(c,{uicontrol:"text",name:"lookup_table_matchvalue","model-value":t.match_value,"onUpdate:modelValue":function(a){t.match_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableMatchValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),Object(o["createElementVNode"])("div",je,[Object(o["createVNode"])(c,{uicontrol:"text",name:"lookup_table_outvalue","model-value":t.out_value,"onUpdate:modelValue":function(a){t.out_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableOutValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),a+1!==e.variable.lookup_table.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:"icon-minus valign",onClick:function(t){return e.removeLookUpEntry(a)},title:e.translate("General_Remove")},null,8,Oe)):Object(o["createCommentVNode"])("",!0)],2)})),128))])])])],512),[[o["vShow"],e.showAdvanced&&(null===(u=e.variable.typeMetadata)||void 0===u?void 0:u.hasAdvancedSettings)]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isVariableDisabled]]),Object(o["withDirectives"])(Object(o["createVNode"])(d,{class:"createButton",onConfirm:t[5]||(t[5]=function(t){return e.edit?e.updateVariable():e.createVariable()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewVariable")},null,8,["disabled","saving","value"]),[[o["vShow"],!e.isVariableDisabled]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Ve,[Object(o["createElementVNode"])("a",{onClick:t[6]||(t[6]=Object(o["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])])],544),[[o["vShow"],!e.chooseVariableType&&e.editTitle]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ye,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.availableVariables,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(o["createElementVNode"])("li",Te,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{key:a,class:Object(o["normalizeClass"])(["collection-item avatar",ae({disabledTemplate:l.isVariableTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(a){return e.createVariableType(t)},title:l.isVariableTemplateDisabled[t.id]?e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates")):""},[t.icon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,Ne)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",Ee,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.description),513),[[o["vShow"],t.description]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",Se,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,we)],512),[[o["vShow"],!!t.help]])],10,Ce)})),128))])})),128)),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ke,[Object(o["createElementVNode"])("a",{onClick:t[8]||(t[8]=Object(o["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])],512),[[o["vShow"],e.chooseVariableType]])]})),_:1},8,["content-title"])],512)}function _e(e,t){return Be(e)||Ae(e,t)||Ie(e,t)||De()}function De(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ae(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function Be(e){if(Array.isArray(e))return e}function Ue(e){return Ue="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function xe(e){return Fe(e)||Pe(e)||Ie(e)||Le()}function Le(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ie(e,t){if(e){if("string"===typeof e)return He(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?He(e,t):void 0}}function Pe(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Fe(e){if(Array.isArray(e))return He(e)}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function $e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Je(e,t,a){return t&&qe(e.prototype,t),a&&qe(e,a),e}function Ge(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Re=function(){function e(){var t=this;$e(this,e),Ge(this,"privateState",Object(o["reactive"])({variables:[],isLoadingVars:!1,isLoadingSingle:!1,isUpdating:!1})),Ge(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Ge(this,"isLoading",Object(o["computed"])((function(){var e=t.state.value;return e.isLoadingVars||e.isLoadingSingle}))),Ge(this,"isUpdating",Object(o["computed"])((function(){return t.state.value.isUpdating}))),Ge(this,"variables",Object(o["computed"])((function(){return t.state.value.variables}))),Ge(this,"fetchPromise",null),Ge(this,"availableVariablesPromises",{})}return Je(e,[{key:"fetchVariablesIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchVariables(e,t)}},{key:"findVariable",value:function(e,t,a){var n=this,i=this.variables.value.find((function(e){return e.idvariable===a}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,r["AjaxHelper"].fetch({idVariable:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerVariable",filter_limit:"-1"}).then((function(e){return n.privateState.variables=[].concat(xe(n.privateState.variables),[e]),Object(o["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"fetchVariables",value:function(e,t){var a=this;return this.privateState.isLoadingVars=!0,this.privateState.variables=[],this.fetchPromise||(this.fetchPromise=r["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return a.privateState.variables=e,a.privateState.isLoadingVars=!1,a.variables.value})).finally((function(){a.privateState.isLoadingVars=!1}))}},{key:"fetchAvailableVariables",value:function(e){return this.availableVariablesPromises[e]||(this.availableVariablesPromises[e]=r["AjaxHelper"].fetch({method:"TagManager.getAvailableVariableTypesInContext",idContext:e,filter_limit:"-1"}).then((function(e){return Object(o["readonly"])(e)}))),Promise.resolve(this.availableVariablesPromises[e])}},{key:"suggestNameForType",value:function(e){for(var t=this,a=function(a){var n=e;a&&(n="".concat(n," (").concat(a,")"));var i=!t.variables.value.some((function(e){return e.name===n}));if(i)return{v:n}},n=0;n<100;n+=1){var i=a(n);if("object"===Ue(i))return i.v}}},{key:"createOrUpdateVariable",value:function(e,t,a,n,i){var o=this;this.privateState.isUpdating=!0;var l=Object.entries(i).map((function(e){var t=_e(e,2),a=t[0],n=t[1],i=n;return"boolean"===typeof n&&(i=(+n).toString()),[a,i]})),c=Object.fromEntries(l),s=e.lookup_table.filter((function(e){return e&&e.out_value&&e.comparison}));return r["AjaxHelper"].post({idVariable:e.idvariable,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,defaultValue:e.default_value},{parameters:c,lookupTable:s},{withTokenInUrl:!0}).finally((function(){o.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.variables=[],this.fetchPromise=null,this.availableVariablesPromises={},this.fetchVariables(e,t)}},{key:"deleteVariable",value:function(e,t,a){var n=this;return this.privateState.isUpdating=!0,this.privateState.variables=[],r["AjaxHelper"].fetch({idVariable:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVariable"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}}]),e}(),ze=new Re;function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ke(e,t,a){return t&&Xe(e.prototype,t),a&&Xe(e,a),e}function Ye(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Qe=function(){function e(){var t=this;We(this,e),Ye(this,"privateState",Object(o["reactive"])({comparisons:[],isLoading:!1})),Ye(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Ye(this,"isLoading",Object(o["computed"])((function(){return t.state.value.isLoading}))),Ye(this,"comparisons",Object(o["computed"])((function(){return t.state.value.comparisons}))),Ye(this,"comparisonOptions",Object(o["computed"])((function(){return t.comparisons.value.map((function(e){var t=e.id,a=e.name;return{key:t,value:a}}))}))),this.fetchAvailableComparisons()}return Ke(e,[{key:"fetchAvailableComparisons",value:function(){var e=this;this.privateState.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getAvailableComparisons",filter_limit:"-1"}).then((function(t){e.privateState.comparisons=t})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Ze=Object(r["lazyInitSingleton"])(Qe),et="tagvariablemanagement",tt=Object(o["defineComponent"])({props:{idVariable:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variableType:String,isEmbedded:{type:Boolean,default:!1}},components:{GroupedSettings:g["GroupedSettings"],ContentBlock:r["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,showAdvanced:!1,chooseVariableType:!1,canUseCustomTemplates:r["Matomo"].hasUserCapability("tagmanager_use_custom_templates"),availableVariables:[],editTitle:"",variable:{},parameterValues:{},isUpdatingVar:!1}},emits:["changeVariable"],created:function(){ze.fetchVariablesIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdVariable()},watch:{idVariable:function(e){null!==e&&this.initIdVariable()},variableParameterValues:{handler:function(e,t){e&&t&&(this.isDirty=!0)},deep:!0},variableLookupTable:{handler:function(){var e=(this.variable.lookup_table||[]).every((function(e){return!(null===e||void 0===e||!e.out_value)}));e&&this.addLookUpEntry()},deep:!0}},methods:{removeAnyVariableNotification:function(){r["NotificationsStore"].remove(et),r["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,id:et,type:"transient"});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(r["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdVariable:function(){var e=this;r["Matomo"].helper.lazyScrollToContent(),this.availableVariables=[],r["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return ze.fetchAvailableVariables(e.context)})).then((function(t){e.availableVariables=t})).then((function(){if(e.edit&&e.idVariable)return e.editTitle=Object(r["translate"])("TagManager_EditVariable"),void ze.findVariable(e.idContainer,e.idContainerVersion,e.idVariable).then((function(t){t&&(e.variable=Object(r["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),(e.variable.lookup_table&&e.variable.lookup_table.length||e.variable.default_value)&&(e.showAdvanced=!0),e.addLookUpEntryIfNoneExists(),e.isDirty=!1)}));if(e.create){var t=!1;e.variableType&&e.availableVariables.forEach((function(a){if(!t){var n=a.types.find((function(t){return(null===t||void 0===t?void 0:t.id)===e.variableType}));n&&(t=!0,e.createVariableType(n))}})),t||(e.editTitle=Object(r["translate"])("TagManager_ChooseVariableToContinue"),e.chooseVariableType=!0)}}))},addLookUpEntryIfNoneExists:function(){this.variable.lookup_table&&Array.isArray(this.variable.lookup_table)||(this.variable.lookup_table=[]),this.variable.lookup_table.length||this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""})},addLookUpEntry:function(){this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""}),this.isDirty=!0},removeLookUpEntry:function(e){e>-1&&(this.variable.lookup_table.splice(e,1),this.isDirty=!0)},createVariableType:function(e){var t=this;e&&this.isVariableTemplateDisabled[e.id]||(this.chooseVariableType=!1,this.editTitle=Object(r["translate"])("TagManager_CreateNewVariable"),this.variable={idsite:parseInt("".concat(r["Matomo"].idSite),10),name:ze.suggestNameForType(e.name)||"",type:e.id,idcontainer:this.idContainer,idcontainerversion:this.idContainerVersion,default_value:"",lookup_table:[],typeMetadata:e},this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addLookUpEntry(),this.isDirty=!0,Object(o["nextTick"])((function(){if(t.$refs.root){var e=t.$refs.root;e.scrollIntoView();var a=e.querySelector("#name");a&&a.focus()}})))},cancel:function(){var e=Object.assign({},r["MatomoUrl"].hashParsed.value);delete e.idVariable,r["MatomoUrl"].updateHash(e)},createVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,ze.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.addContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t){e.isDirty=!1;var a=t.value;ze.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.variable.idvariable=a,void e.$emit("changeVariable",{variable:e.variable});r["Matomo"].helper.isAngularRenderingThePage()?r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idVariable:a})):r["MatomoUrl"].updateHash({idVariable:a}),setTimeout((function(){var t=Object(r["translate"])("TagManager_CreatedX",Object(r["translate"])("TagManager_Variable")),a=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");e.showNotification("".concat(t," ").concat(a),"success")}),200)}))}})).finally((function(){e.isUpdatingVar=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,ze.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.updateContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t)if(e.isEmbedded)e.$emit("changeVariable",{variable:e.variable});else{e.isDirty=!1,ze.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdVariable()}));var a=Object(r["translate"])("TagManager_UpdatedX",Object(r["translate"])("TagManager_Variable")),n=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");e.showNotification("".concat(a," ").concat(n),"success")}})).finally((function(){e.isUpdatingVar=!1})))},checkRequiredFieldsAreSet:function(){return!!this.variable.name||(this.showErrorFieldNotProvidedNotification(Object(r["translate"])("General_Name")),!1)}},computed:{typeInlineHelp:function(){var e,t,a=(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.description)||"",n=(null===(t=this.variable.typeMetadata)||void 0===t?void 0:t.help)||"";return"".concat(a," ").concat(n)},create:function(){return 0===this.idVariable},edit:function(){return!this.create},isLoading:function(){return ze.isLoading.value||Ze.isLoading.value},isUpdating:function(){return ze.isUpdating.value||this.isUpdatingVar},availableLookUpComparisons:function(){return Ze.comparisonOptions.value},isVariableTemplateDisabled:function(){var e=this,t={};return this.availableVariables.forEach((function(a){a.types.forEach((function(a){t[a.id]=!e.canUseCustomTemplates&&a.isCustomTemplate}))})),t},isVariableDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},variableParameterValues:function(){var e;return null!==(e=this.variable.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null},variableLookupTable:function(){return this.variable.lookup_table}}});tt.render=Me;var at=tt,nt=(Object(r["createAngularJsAdapter"])({component:at,scope:{idVariable:{angularJsBind:"="},idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},variableType:{angularJsBind:"=?"},isEmbedded:{default:function(e){return!!e.onChangeVariable}},onChangeVariable:{angularJsBind:"&?",vue:"changeVariable"}},directiveName:"piwikVariableEdit",events:{onChangeVariable:function(e,t,a){a.idVariable=e.variable.idvariable}},postCreate:function(e,t){t.$on("$destroy",(function(){t.idVariable=null}))}}),{class:"tagManagerManageList tagManagerVariableList"}),it={class:"name"},rt={class:"type"},ot={class:"lookupTable"},lt={class:"lastUpdated"},ct={colspan:"7"},st={class:"loadingPiwik"},dt=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ut={colspan:"7"},gt=["id"],bt={class:"name"},mt=["title"],pt={class:"lookupTable"},ft={class:"icon-ok"},vt=["title"],ht={class:"action"},jt=["onClick","title"],Ot=["onClick","title"],Vt={class:"tableActionBar"},yt=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),Tt=["title"],Ct=Object(o["createElementVNode"])("span",{class:"icon-help preconfiguredVariablesHelp"},null,-1),Nt={class:"collection-header"},Et={class:"title"},St=["textContent"],wt={class:"secondary-content"},kt=["title"],Mt={class:"ui-confirm",id:"confirmDeleteVariable",ref:"confirmDeleteVariable"},_t=["value"],Dt=["value"],At={class:"ui-confirm",id:"confirmDeleteVariableNotPossible",ref:"confirmDeleteVariableNotPossible"},Bt={class:"collection"},Ut=["value"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function xt(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ContentBlock"),c=Object(o["resolveDirective"])("content-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",nt,[Object(o["createVNode"])(l,{feature:"Tag Manager",class:"tagManagerCustomVariablesList","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Variables"))},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableUsageBenefits")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("table",null,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",it,Object(o["toDisplayString"])(e.translate("General_Name")),1),Object(o["createElementVNode"])("th",rt,Object(o["toDisplayString"])(e.translate("TagManager_Type")),1),Object(o["createElementVNode"])("th",ot,Object(o["toDisplayString"])(e.translate("TagManager_LookupTable")),1),Object(o["createElementVNode"])("th",lt,Object(o["toDisplayString"])(e.translate("TagManager_LastUpdated")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("th",{class:"action"},Object(o["toDisplayString"])(e.translate("General_Actions")),513),[[o["vShow"],e.hasWriteAccess]])])]),Object(o["createElementVNode"])("tbody",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",ct,[Object(o["createElementVNode"])("span",st,[dt,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[o["vShow"],e.isLoading||e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",ut,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_NoVariablesFound"))+" ",1),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createContainerVariableNow",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewVariableNow")),513),[[o["vShow"],e.hasWriteAccess]])])],512),[[o["vShow"],!e.isLoading&&!e.variables.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sortedVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{id:"variable".concat(t.idvariable),class:"variables",key:t.idvariable},[Object(o["createElementVNode"])("td",bt,Object(o["toDisplayString"])(t.name),1),Object(o["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(o["toDisplayString"])(t.typeMetadata.name),9,mt),Object(o["createElementVNode"])("td",pt,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",ft,null,512),[[o["vShow"],t.lookup_table.length]])]),Object(o["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.updated_date_pretty),1)],8,vt),Object(o["withDirectives"])(Object(o["createElementVNode"])("td",ht,[Object(o["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(a){return e.editVariable(t.idvariable,t.type)},title:e.translate("TagManager_EditVariable")},null,8,jt),Object(o["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(a){return e.deleteVariable(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Variable"))},null,8,Ot)],512),[[o["vShow"],e.hasWriteAccess]])],8,gt)})),128))])],512),[[c]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Vt,[Object(o["createElementVNode"])("a",{class:"createNewVariable",value:"",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[yt,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)])],512),[[o["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("h2",{title:e.translate("TagManager_PreConfiguredInfoTitle")},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables"))+" ",1),Ct],8,Tt),Object(o["createElementVNode"])("div",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(e,t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t},[Object(o["createElementVNode"])("li",Nt,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.types,(function(e){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:e.id},[Object(o["createElementVNode"])("span",Et,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.name)+" ",1),Object(o["createElementVNode"])("span",{class:"variableId",textContent:Object(o["toDisplayString"])("{{".concat(e.id,"}}"))},null,8,St)]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",wt,[Object(o["createElementVNode"])("i",{class:"icon-help",title:e.description},null,8,kt)],512),[[o["vShow"],!!e.description]])],512)),[[o["vShow"],e.is_pre_configured]])})),128))])})),128))]),Object(o["createElementVNode"])("div",Mt,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_DeleteVariableConfirm")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,_t),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Dt)],512),Object(o["createElementVNode"])("div",At,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableCannotBeDeleted")),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableBeingUsedBy")),1),Object(o["createElementVNode"])("ul",Bt,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.variableReferences,(function(e){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:"".concat(e.referenceType,".").concat(e.referenceId)},Object(o["toDisplayString"])(e.referenceTypeName)+": "+Object(o["toDisplayString"])(e.referenceName),1)})),128))]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableBeingUsedNeedsRemove")),1),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,Ut)],512)])}function Lt(e){return Ht(e)||Ft(e)||Pt(e)||It()}function It(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pt(e,t){if(e){if("string"===typeof e)return $t(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?$t(e,t):void 0}}function Ft(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ht(e){if(Array.isArray(e))return $t(e)}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var qt=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0}},components:{ContentBlock:r["ContentBlock"]},directives:{ContentTable:r["ContentTable"]},data:function(){return{hasWriteAccess:r["Matomo"].hasUserCapability("tagmanager_write"),variableReferences:[],containerVariables:[]}},created:function(){var e=this;ze.fetchVariables(this.idContainer,this.idContainerVersion),r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then((function(t){e.containerVariables=t}))},methods:{createVariable:function(){this.editVariable(0)},editVariable:function(e){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idVariable:e}))},deleteVariable:function(e){var t=this;r["AjaxHelper"].fetch({method:"TagManager.getContainerVariableReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idVariable:e.idvariable}).then((function(a){a&&a.length?(t.variableReferences=a,r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariableNotPossible,{})):(t.variableReferences=[],r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariable,{yes:function(){ze.deleteVariable(t.idContainer,t.idContainerVersion,e.idvariable).then((function(){ze.reload(t.idContainer,t.idContainerVersion)}))}}))}))}},computed:{isLoading:function(){return ze.isLoading.value},isUpdating:function(){return ze.isUpdating.value},variables:function(){return ze.variables.value},sortedVariables:function(){var e=Lt(this.variables);return e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),e}}});qt.render=xt;var Jt=qt,Gt=(Object(r["createAngularJsAdapter"])({component:Jt,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="}},directiveName:"piwikVariableList"}),{class:"manageVariable"}),Rt={key:0},zt={key:1};
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Wt(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("VariableList"),c=Object(o["resolveComponent"])("VariableEdit");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Gt,[e.editMode?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Rt,[Object(o["createVNode"])(l,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer},null,8,["id-container-version","id-container"])])),e.editMode?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",zt,[Object(o["createVNode"])(c,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"id-variable":e.idVariable},null,8,["id-container-version","id-container","id-variable"])])):Object(o["createCommentVNode"])("",!0)])}var Xt=Object(o["defineComponent"])({props:{idContainerVersion:Number,idContainer:String},components:{VariableList:Jt,VariableEdit:at},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(o["watch"])((function(){return r["MatomoUrl"].hashParsed.value.idVariable}),(function(t){e.onIdVariableParamChange(t)})),r["NotificationsStore"].remove("variablevariablemanagement"),this.onIdVariableParamChange(r["MatomoUrl"].hashParsed.value.idVariable)},methods:{onIdVariableParamChange:function(e){if("0"===e){var t={isAllowed:!0};r["Matomo"].postEvent("TagManager.initAddVariable",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idVariable:function(){var e=r["MatomoUrl"].hashParsed.value.idVariable;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idVariable}}});Xt.render=Wt;var Kt=Xt;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(r["createAngularJsAdapter"])({component:Kt,scope:{idContainerVersion:{angularJsBind:"@",transform:function(e){return e?parseInt(e,10):void 0}},idContainer:{angularJsBind:"@"}},directiveName:"piwikVariableManage"});function Yt(e,t){return ea(e)||Zt(e,t)||ia(e,t)||Qt()}function Qt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Zt(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function ea(e){if(Array.isArray(e))return e}function ta(e){return ta="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(e)}function aa(e){return oa(e)||ra(e)||ia(e)||na()}function na(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ia(e,t){if(e){if("string"===typeof e)return la(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?la(e,t):void 0}}function ra(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function oa(e){if(Array.isArray(e))return la(e)}function la(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function ca(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sa(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function da(e,t,a){return t&&sa(e.prototype,t),a&&sa(e,a),e}function ua(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var ga=function(){function e(){var t=this;ca(this,e),ua(this,"privateState",Object(o["reactive"])({triggers:[],isLoadingTriggers:!1,isLoadingSingle:!1,isUpdating:!1})),ua(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),ua(this,"isUpdating",Object(o["computed"])((function(){return t.state.value.isUpdating}))),ua(this,"isLoading",Object(o["computed"])((function(){var e=t.state.value;return e.isLoadingTriggers||e.isLoadingSingle}))),ua(this,"triggers",Object(o["computed"])((function(){return t.state.value.triggers}))),ua(this,"fetchPromise",null),ua(this,"availableTriggersPromises",{})}return da(e,[{key:"fetchTriggers",value:function(e,t){var a=this;return this.privateState.triggers=[],this.privateState.isLoadingTriggers=!0,this.fetchPromise||(this.fetchPromise=r["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return a.privateState.triggers=e,a.triggers.value})).finally((function(){a.privateState.isLoadingTriggers=!1}))}},{key:"fetchTriggersIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchTriggers(e,t)}},{key:"fetchAvailableTriggers",value:function(e){return this.availableTriggersPromises[e]||(this.availableTriggersPromises[e]=r["AjaxHelper"].fetch({method:"TagManager.getAvailableTriggerTypesInContext",idContext:e,filter_limit:"-1"})),Promise.resolve(this.availableTriggersPromises[e])}},{key:"findTrigger",value:function(e,t,a){var n=this,i=this.triggers.value.find((function(e){return e.idtrigger===a}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,r["AjaxHelper"].fetch({idTrigger:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTrigger",filter_limit:"-1"}).then((function(e){return n.privateState.triggers=[].concat(aa(n.privateState.triggers),[e]),Object(o["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"suggestNameForType",value:function(e){for(var t=this,a=function(a){var n=e;a&&(n="".concat(n," (").concat(a,")"));var i=!t.triggers.value.some((function(e){return e.name===n}));if(i)return{v:n}},n=0;n<100;n+=1){var i=a(n);if("object"===ta(i))return i.v}}},{key:"createOrUpdateTrigger",value:function(e,t,a,n,i){var o=this,l=Object.entries(i).map((function(e){var t=Yt(e,2),a=t[0],n=t[1],i=n;return"boolean"===typeof n&&(i=(+n).toString()),[a,i]})),c=Object.fromEntries(l),s=e.conditions.filter((function(e){return e&&e.actual&&e.comparison&&e.expected}));return this.privateState.isUpdating=!0,r["AjaxHelper"].post({idTrigger:e.idtrigger,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name},{parameters:c,conditions:s},{withTokenInUrl:!0}).finally((function(){o.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.triggers=[],this.fetchPromise=null,this.availableTriggersPromises={},this.fetchTriggers(e,t)}},{key:"deleteTrigger",value:function(e,t,a){var n=this;return this.privateState.isUpdating=!0,this.privateState.triggers=[],r["AjaxHelper"].fetch({idTrigger:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTrigger"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}}]),e}(),ba=new ga;function ma(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */
window.angular.module("piwikApp").factory("tagManagerTriggerModel",(function(){return ba}));var pa={class:"editTrigger tagManagerManageEdit",ref:"root"},fa={class:"loadingPiwik"},va=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ha={class:"loadingPiwik"},ja=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Oa={class:"form-group row"},Va={class:"col s12"},ya={key:0},Ta={class:"form-group row"},Ca={class:"col s12"},Na={class:"form-group row multiple"},Ea={class:"col s12 m12"},Sa={class:"innerFormField"},wa={class:"innerFormField comparisonField"},ka={class:"innerFormField"},Ma=["onClick","title"],_a={class:"triggerConditionNode"},Da={class:"entityCancel"},Aa={id:"confirmSelectTriggerType"},Ba={class:"collection-header"},Ua=["onClick","title"],xa=["src"],La={class:"title"},Ia={class:"secondary-content"},Pa=["title"],Fa={class:"entityCancel"};function Ha(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field"),c=Object(o["resolveComponent"])("GroupedSettings"),s=Object(o["resolveComponent"])("SaveButton"),d=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",pa,[Object(o["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(o["withCtx"])((function(){var a,n,i,r,d,u,g,b;return[Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",fa,[va,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[o["vShow"],e.isLoading]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",ha,[ja,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[o["vShow"],e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("form",{onSubmit:t[4]||(t[4]=function(t){return e.edit?e.updateTrigger():e.createTrigger()})},[Object(o["createElementVNode"])("div",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isTriggerDisabled]]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"type","model-value":null===(a=e.trigger.typeMetadata)||void 0===a?void 0:a.name,disabled:!0,"inline-help":"".concat(null===(n=e.trigger.typeMetadata)||void 0===n?void 0:n.description," ").concat(null===(i=e.trigger.typeMetadata)||void 0===i?void 0:i.help),title:e.translate("TagManager_Type")},null,8,["model-value","inline-help","title"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.trigger.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.trigger.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_TriggerNameHelp")},null,8,["model-value","title","inline-help"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Oa,[Object(o["createElementVNode"])("div",Va,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureThisTrigger")),1)])],512),[[o["vShow"],null===(r=e.trigger.typeMetadata)||void 0===r||null===(d=r.parameters)||void 0===d?void 0:d.length]]),e.trigger?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ya,[Object(o["createVNode"])(c,{settings:(null===(u=e.trigger.typeMetadata)||void 0===u?void 0:u.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[1]||(t[1]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Ta,[Object(o["createElementVNode"])("div",Ca,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_OnlyTriggerWhen"))+" "+Object(o["toDisplayString"])(e.translate("Goals_Optional")),1)])],512),[[o["vShow"],null===(g=e.trigger.typeMetadata)||void 0===g?void 0:g.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",Na,[Object(o["createElementVNode"])("div",Ea,[Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerConditionsHelp")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.trigger.conditions,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:a,class:Object(o["normalizeClass"])(["condition multiple valign-wrapper","condition".concat(a)])},[Object(o["createElementVNode"])("div",Sa,[Object(o["createVNode"])(l,{uicontrol:"expandable-select",name:"condition_actual","model-value":t.actual,"onUpdate:modelValue":function(a){t.actual=a,e.setValueHasChanged()},"full-width":!0,options:e.availableVariables,title:e.variableIdToName[t.actual]||t.actual},null,8,["model-value","onUpdate:modelValue","options","title"])]),Object(o["createElementVNode"])("div",wa,[Object(o["createVNode"])(l,{uicontrol:"select",name:"condition_comparison","model-value":t.comparison,"onUpdate:modelValue":function(a){t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(o["createElementVNode"])("div",ka,[Object(o["createVNode"])(l,{uicontrol:"text",name:"condition_expected","model-value":t.expected,"onUpdate:modelValue":function(a){t.expected=a,e.setValueHasChanged(),e.onConditionChange()},"full-width":!0},null,8,["model-value","onUpdate:modelValue"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"icon-minus valign",onClick:function(t){return e.removeConditionEntry(a)},title:e.translate("General_Remove")},null,8,Ma),[[o["vShow"],!(a+1===e.trigger.conditions.length)]])],2)})),128))]),Object(o["createElementVNode"])("p",_a,Object(o["toDisplayString"])(e.translate("TagManager_TriggerConditionNode")),1)])])],512),[[o["vShow"],null===(b=e.trigger.typeMetadata)||void 0===b?void 0:b.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isTriggerDisabled]]),Object(o["withDirectives"])(Object(o["createVNode"])(s,{class:"createButton",onConfirm:t[2]||(t[2]=function(t){return e.edit?e.updateTrigger():e.createTrigger()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"]),[[o["vShow"],!e.isTriggerDisabled]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Da,[Object(o["createElementVNode"])("a",{onClick:t[3]||(t[3]=function(t){return e.cancel()})},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])])],544),[[o["vShow"],!e.chooseTriggerType&&e.editTitle]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Aa,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.availableTriggers,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(o["createElementVNode"])("li",Ba,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:Object(o["normalizeClass"])(["collection-item avatar",ma({disabledTemplate:e.isTriggerTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(a){return e.createTriggerType(t)},key:a,title:e.isTriggerTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,xa)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",La,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.description),513),[[o["vShow"],t.description]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",Ia,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Pa)],512),[[o["vShow"],!!t.help]])],10,Ua)})),128))])})),128)),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Fa,[Object(o["createElementVNode"])("a",{onClick:t[5]||(t[5]=function(t){return e.cancel()})},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])],512),[[o["vShow"],e.chooseTriggerType]])]})),_:1},8,["content-title"])],512)}var $a="tagvariablemanagement",qa={AllElementsClick:"ClickId",AllLinksClick:"ClickId",DownloadClick:"ClickId",ElementVisibility:"VisibleElementClasses",FormSubmit:"FormId",JavaScriptError:"ErrorMessage"},Ja=Object(o["defineComponent"])({props:{idTrigger:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTriggerType:String,isEmbedded:{type:Boolean,default:!1}},components:{ContentBlock:r["ContentBlock"],Field:g["Field"],GroupedSettings:g["GroupedSettings"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,chooseTriggerType:!1,availableTriggers:[],availableVariables:[],variableIdToName:{},editTitle:"",trigger:{},parameterValues:{},isUpdatingTrigger:!1}},emits:["changeTrigger"],created:function(){var e=this;r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion}).then((function(t){t.forEach((function(t){t.types.forEach((function(a){e.variableIdToName[a.id]=a.name,e.availableVariables.push({key:a.id,value:a.name,group:t.name})}))}))})),ba.fetchTriggersIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdTrigger()},watch:{idTrigger:function(e){null!==e&&this.initIdTrigger()},triggerParameterValues:{handler:function(e,t){e&&t&&(this.isDirty=!0)},deep:!0}},methods:{checkRequiredFieldsAreSet:function(){return!!this.trigger.name||(this.showErrorFieldNotProvidedNotification(Object(r["translate"])("General_Name")),!1)},removeAnyTriggerNotification:function(){r["NotificationsStore"].remove($a),r["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,id:$a,type:"transient"});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(r["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTrigger:function(){var e=this;this.trigger={},this.chooseTriggerType=!1,this.editTitle="",r["Matomo"].helper.lazyScrollToContent(),this.availableTriggers=[],r["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return ba.fetchAvailableTriggers(e.context)})).then((function(t){e.availableTriggers=t})).then((function(){if(e.edit&&e.idTrigger)return e.editTitle=Object(r["translate"])("TagManager_EditTrigger"),void ba.findTrigger(e.idContainer,e.idContainerVersion,e.idTrigger).then((function(t){t&&(e.trigger=Object(r["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),e.addConditionEntryIfNoneExists(),e.onConditionChange(),e.isDirty=!1)}));e.create&&(e.editTitle=Object(r["translate"])("TagManager_ChooseTriggerToContinue"),e.chooseTriggerType=!0)}))},onConditionChange:function(){var e=(this.trigger.conditions||[]).every((function(e){return!(null===e||void 0===e||!e.expected)}));e&&this.addConditionEntry()},addConditionEntryIfNoneExists:function(){this.trigger.conditions&&Array.isArray(this.trigger.conditions)||(this.trigger.conditions=[]),this.trigger.conditions.length||this.trigger.conditions.push(this.makeDefaultCondition())},addConditionEntry:function(){this.trigger.conditions.push(this.makeDefaultCondition()),this.isDirty=!0},removeConditionEntry:function(e){if(e>-1){var t=this.trigger.conditions.length-1;t===e?this.trigger.conditions[e]=this.makeDefaultCondition():this.trigger.conditions.splice(e,1),this.isDirty=!0}},createTriggerType:function(e){var t=this;e&&this.isTriggerTemplateDisabled[e.id]||(this.chooseTriggerType=!1,this.editTitle=Object(r["translate"])("TagManager_CreateNewTrigger"),this.trigger={idsite:parseInt("".concat(r["Matomo"].idSite),10),name:ba.suggestNameForType(e.name)||"",type:e.id,idcontainerversion:this.idContainerVersion,conditions:[],typeMetadata:e},this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addConditionEntry(),this.isDirty=!0,Object(o["nextTick"])((function(){if(t.$refs.root){var e=t.$refs.root;e.scrollIntoView();var a=e.querySelector("#name");a&&a.focus()}})))},cancel:function(){var e=Object.assign({},r["MatomoUrl"].hashParsed.value);delete e.idTrigger,r["MatomoUrl"].updateHash(e)},createTrigger:function(){var e=this;this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,ba.createOrUpdateTrigger(this.trigger,"TagManager.addContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){var a=t.value;e.isDirty=!1,ba.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.trigger.idtrigger=a,void e.$emit("changeTrigger",{trigger:e.trigger});r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idTrigger:a})),setTimeout((function(){var t=Object(r["translate"])("TagManager_CreatedX",Object(r["translate"])("TagManager_Trigger")),a=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a href="" class="createNewVersionLink">',"</a>");e.showNotification("".concat(t," ").concat(a),"success")}),200)}))})).finally((function(){e.isUpdatingTrigger=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateTrigger:function(){var e=this;this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,ba.createOrUpdateTrigger(this.trigger,"TagManager.updateContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t)if(e.isEmbedded)e.$emit("changeTrigger",{trigger:e.trigger});else{e.isDirty=!1,ba.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdTrigger()}));var a=Object(r["translate"])("TagManager_UpdatedX",Object(r["translate"])("TagManager_Trigger")),n=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a href="" class="createNewVersionLink">',"</a>");e.showNotification("".concat(a," ").concat(n),"success")}})).finally((function(){e.isUpdatingTrigger=!1})))},makeDefaultCondition:function(){var e,t="PageUrl";if(null!==(e=this.trigger)&&void 0!==e&&e.typeMetadata){var a=this.trigger.typeMetadata.id;qa[a]&&(t=qa[a])}return{comparison:"equals",actual:t,expected:""}}},computed:{isLoading:function(){return ba.isLoading.value||Ze.isLoading.value},isUpdating:function(){return ba.isUpdating.value||this.isUpdatingTrigger},create:function(){return 0===this.idTrigger},edit:function(){return!this.create},canUseCustomTemplates:function(){return r["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTriggerDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.trigger.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},saveButtonText:function(){return this.edit?Object(r["translate"])("CoreUpdater_UpdateTitle"):Object(r["translate"])("TagManager_CreateNewTrigger")},collectionItemAvatarText:function(){return Object(r["translate"])("TagManager_UseCustomTemplateCapabilityRequired",Object(r["translate"])("TagManager_CapabilityUseCustomTemplates"))},availableComparisons:function(){return Ze.comparisonOptions.value},isTriggerTemplateDisabled:function(){var e=this,t={};return this.availableTriggers.forEach((function(a){a.types.forEach((function(a){t[a.id]=!e.canUseCustomTemplates&&a.isCustomTemplate}))})),t},triggerParameterValues:function(){var e;return null!==(e=this.trigger.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null}}});Ja.render=Ha;var Ga=Ja,Ra=(Object(r["createAngularJsAdapter"])({component:Ga,scope:{idTrigger:{angularJsBind:"="},idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},newTriggerType:{angularJsBind:"="},isEmbedded:{default:function(e){return!!e.onChangeTrigger}},onChangeTrigger:{angularJsBind:"&?",vue:"changeTrigger"}},directiveName:"piwikTriggerEdit",events:{onChangeTrigger:function(e,t,a){a.idTrigger=e.trigger.idtrigger}},postCreate:function(e,t){t.$on("$destroy",(function(){t.idTrigger=null}))}}),{class:"tagManagerManageList tagManagerTriggerList"}),za={class:"name"},Wa={class:"type"},Xa={class:"conditions"},Ka={class:"lastUpdated"},Ya={colspan:"7"},Qa={class:"loadingPiwik"},Za=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),en={colspan:"7"},tn=["id"],an={class:"name"},nn=["title"],rn={class:"conditions"},on={class:"icon-ok"},ln=["title"],cn={class:"action"},sn=["onClick","title"],dn=["onClick","title"],un={class:"tableActionBar"},gn=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),bn={class:"ui-confirm",id:"confirmDeleteTrigger",ref:"confirmDeleteTrigger"},mn=["value"],pn=["value"],fn={class:"ui-confirm",id:"confirmDeleteTriggerNotPossible",ref:"confirmDeleteTriggerNotPossible"},vn={class:"collection"},hn=["value"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function jn(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ContentBlock"),c=Object(o["resolveDirective"])("content-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Ra,[Object(o["createVNode"])(l,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Triggers"))},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerUsageBenefits")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("table",null,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",za,Object(o["toDisplayString"])(e.translate("General_Name")),1),Object(o["createElementVNode"])("th",Wa,Object(o["toDisplayString"])(e.translate("TagManager_Type")),1),Object(o["createElementVNode"])("th",Xa,Object(o["toDisplayString"])(e.translate("TagManager_Filter")),1),Object(o["createElementVNode"])("th",Ka,Object(o["toDisplayString"])(e.translate("TagManager_LastUpdated")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("th",{class:"action"},Object(o["toDisplayString"])(e.translate("General_Actions")),513),[[o["vShow"],e.hasWriteAccess]])])]),Object(o["createElementVNode"])("tbody",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",Ya,[Object(o["createElementVNode"])("span",Qa,[Za,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[o["vShow"],e.isLoading||e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",en,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+" ",1),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createContainerTriggerNow",onClick:t[0]||(t[0]=function(t){return e.createTrigger()})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),513),[[o["vShow"],e.hasWriteAccess]])])],512),[[o["vShow"],!e.isLoading&&0===e.triggers.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sortedTriggers,(function(t){var a;return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{id:"trigger".concat(t.idtrigger),class:"triggers",key:t.idtrigger},[Object(o["createElementVNode"])("td",an,Object(o["toDisplayString"])(t.name),1),Object(o["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(o["toDisplayString"])(t.typeMetadata.name),9,nn),Object(o["createElementVNode"])("td",rn,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",on,null,512),[[o["vShow"],null===(a=t.conditions)||void 0===a?void 0:a.length]])]),Object(o["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.updated_date_pretty),1)],8,ln),Object(o["withDirectives"])(Object(o["createElementVNode"])("td",cn,[Object(o["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(a){return e.editTrigger(t.idtrigger,t.type)},title:e.translate("TagManager_EditTrigger")},null,8,sn),Object(o["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(a){return e.deleteTrigger(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Trigger"))},null,8,dn)],512),[[o["vShow"],e.hasWriteAccess]])],8,tn)})),128))])],512),[[c]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",un,[Object(o["createElementVNode"])("a",{class:"createNewTrigger",value:"",onClick:t[1]||(t[1]=function(t){return e.createTrigger()})},[gn,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTrigger")),1)])],512),[[o["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",bn,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_DeleteTriggerConfirm")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,mn),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,pn)],512),Object(o["createElementVNode"])("div",fn,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerCannotBeDeleted")),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedBy")),1),Object(o["createElementVNode"])("ul",vn,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.triggerReferences,(function(e){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:e.referenceId},Object(o["toDisplayString"])(e.referenceTypeName)+": "+Object(o["toDisplayString"])(e.referenceName),1)})),128))]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedNeedsRemove")),1),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,hn)],512)])}function On(e){return Cn(e)||Tn(e)||yn(e)||Vn()}function Vn(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function yn(e,t){if(e){if("string"===typeof e)return Nn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Nn(e,t):void 0}}function Tn(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Cn(e){if(Array.isArray(e))return Nn(e)}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var En=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0}},components:{ContentBlock:r["ContentBlock"]},directives:{ContentTable:r["ContentTable"]},data:function(){return{hasWriteAccess:r["Matomo"].hasUserCapability("tagmanager_write"),triggerReferences:[]}},created:function(){ba.fetchTriggers(this.idContainer,this.idContainerVersion)},methods:{createTrigger:function(){this.editTrigger(0)},editTrigger:function(e){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idTrigger:e}))},deleteTrigger:function(e){var t=this;r["AjaxHelper"].fetch({method:"TagManager.getContainerTriggerReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idTrigger:e.idtrigger}).then((function(a){if(a&&a.length)t.triggerReferences=a,r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteTriggerNotPossible,{});else{t.triggerReferences=[];var n=function(){ba.deleteTrigger(t.idContainer,t.idContainerVersion,e.idtrigger).then((function(){ba.reload(t.idContainer,t.idContainerVersion)}))};r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteTrigger,{yes:n})}}))}},computed:{isLoading:function(){return ba.isLoading.value},isUpdating:function(){return ba.isUpdating.value},triggers:function(){return ba.triggers.value},sortedTriggers:function(){var e=On(this.triggers);return e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),e}}});En.render=jn;var Sn=En,wn=(Object(r["createAngularJsAdapter"])({component:Sn,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="}},directiveName:"piwikTriggerList"}),{class:"manageTrigger"});
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function kn(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("TriggerList"),c=Object(o["resolveComponent"])("TriggerEdit");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",wn,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion},null,8,["id-container","id-container-version"])])],512),[[o["vShow"],!e.editMode]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-trigger":e.idTrigger},null,8,["id-container","id-container-version","id-trigger"])])],512),[[o["vShow"],e.editMode]])])}var Mn=Object(o["defineComponent"])({props:{idContainerVersion:Number,idContainer:String},components:{TriggerList:Sn,TriggerEdit:Ga},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(o["watch"])((function(){return r["MatomoUrl"].hashParsed.value.idTrigger}),(function(t){e.onIdTriggerParamChange(t)})),r["NotificationsStore"].remove("triggertriggermanagement"),this.onIdTriggerParamChange(r["MatomoUrl"].hashParsed.value.idTrigger)},methods:{onIdTriggerParamChange:function(e){if("0"===e){var t={isAllowed:!0};r["Matomo"].postEvent("TagManager.initAddTrigger",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idTrigger:function(){var e=r["MatomoUrl"].hashParsed.value.idTrigger;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idTrigger}}});Mn.render=kn;var _n=Mn,Dn=(Object(r["createAngularJsAdapter"])({component:_n,scope:{idContainerVersion:{angularJsBind:"@",transform:function(e){return"string"===typeof e?parseInt(e,10):e}},idContainer:{angularJsBind:"@"}},directiveName:"piwikTriggerManage"}),{class:"fieldVariableTemplate"}),An=["type","id","name","value"],Bn=["title"],Un=["for","innerHTML"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function xn(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Dn,[Object(o["createElementVNode"])("textarea",Object(o["mergeProps"])({class:"control_".concat(e.uiControl," materialize-textarea"),type:e.uiControl,id:e.name,name:e.name,value:e.modelValue,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"textarea"}),null,16,An),Object(o["createElementVNode"])("span",{class:"icon-code",style:{"margin-top":"14px",position:"absolute"},title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,Bn),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,Un)])}var Ln=window,In=Ln.tagManagerHelper,Pn=Object(o["defineComponent"])({props:{name:String,uiControlAttributes:Object,modelValue:String,title:String,uiControl:{type:String,required:!0}},inheritAttrs:!1,emits:["update:modelValue"],created:function(){this.onKeydown=Object(r["debounce"])(this.onKeydown.bind(this),50)},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;In.selectVariable((function(t){In.insertTextSnippetAtElement(e.$refs.textarea,"{{".concat(t.id,"}}"))}))}},watch:{modelValue:function(){var e=this,t=window,a=t.Materialize;setTimeout((function(){a.textareaAutoResize(e.$refs.textarea),a.updateTextFields()}))}},mounted:function(){var e=this,t=window,a=t.Materialize;setTimeout((function(){a.textareaAutoResize(e.$refs.textarea),a.updateTextFields()}))}});Pn.render=xn;var Fn=Pn,Hn={class:"fieldVariableTemplate"},$n=["type","id","name","value"],qn=["title"],Jn=["for","innerHTML"];function Gn(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Hn,[Object(o["createElementVNode"])("input",Object(o["mergeProps"])({class:"control_".concat(e.uiControl),type:e.uiControl,id:e.name,name:e.name,value:e.modelValueText,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"input"}),null,16,$n),Object(o["createElementVNode"])("span",{class:"icon-code",title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,qn),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,Jn)])}var Rn=window,zn=Rn.tagManagerHelper,Wn=Object(o["defineComponent"])({props:{uiControl:{type:String,required:!0},uiControlAttributes:Object,name:String,title:String,modelValue:null},inheritAttrs:!1,emits:["update:modelValue"],computed:{modelValueText:function(){return"undefined"===typeof this.modelValue||null===this.modelValue?"":this.modelValue.toString()}},created:function(){this.onKeydown=Object(r["debounce"])(this.onKeydown.bind(this),50)},mounted:function(){setTimeout((function(){window.Materialize.updateTextFields()}))},watch:{modelValue:function(){setTimeout((function(){window.Materialize.updateTextFields()}))}},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;zn.selectVariable((function(t){zn.insertTextSnippetAtElement(e.$refs.input,"{{".concat(t.id,"}}"))}))}}});Wn.render=Gn;var Xn=Wn,Kn=["for","innerHTML"];function Yn(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("VariableSelectType");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createVNode"])(l,{"model-value":e.modelValue,id:e.name,name:e.name,"variable-type-name":e.title,"variable-type":e.uiControlAttributes.variableType,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t)})},null,8,["model-value","id","name","variable-type-name","variable-type"]),Object(o["createElementVNode"])("label",{for:e.name,style:{"font-size":"0.8rem"},innerHTML:e.$sanitize(e.title)},null,8,Kn)])}var Qn=Object(o["defineComponent"])({props:{uiControlAttributes:{type:Object,required:!0},name:String,title:String,modelValue:String},components:{VariableSelectType:te},emits:["update:modelValue"]});Qn.render=Yn;var Zn=Qn;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=TagManager.umd.min.js.map