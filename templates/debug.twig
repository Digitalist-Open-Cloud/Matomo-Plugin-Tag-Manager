<!DOCTYPE html>
<html id="ng-app" ng-app="piwikApp">
<head>
    <title>Debug Matomo Tag Manager</title>
    <base href="{{ piwikUrl|e('html_attr') }}" >
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=1"/>
    <meta name="viewport" content="initial-scale=1.0"/>
    <meta name="robots" content="noindex,nofollow">
    <style>
        .nav-wrapper .brand-logo {
            position: relative;
            pointer-events: none;
        }
        .home h2, .home h3 {
            margin-top: 0;
        }

        .tm-icon-ok {
            position: absolute;
            background-repeat: no-repeat;
            display: inline-block;
            background-size: cover;
            margin-left: 0.5rem;
            margin-top: 2px;
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAEDUlEQVRoge2XXWxURRTH/+fe/ShBioFo8NvaNmrLhyI2kDal22px0cVEWZSYQtHSIIREn4wmhkXro9EHI6EIaVIjUoS2VEqtJG7j1oJiGi3EwpYtiFEUEyAL2u7eO8cHRe323r2zH3Ebc3/JvMz8z/+ck72zMwPY2NjY2NjY5A7KdQFGrD/rKwXoTRZ8UkP0pZaC4JiZdso10HDGV0BAP4Cb/po6Qi74mm/u+tVIr/x3pVmzLuy9QQEO4Z/iAWAxx9DXeNp3u1HMlGlgc9ib73A6ehi422C5BA6E/vy0JjIlGtgc9rrHnI52AAvNNMy4DYwu8MTPPucNBDigjDkdrQCqrbQMTEucy3kDP5z9+h0AfglpjEipA4H/PZnTBhpHVwQIeF5CKph5zY47Og8nLuTsb3T96GMbGNgmp+YX3ys4+LbRimUDG09UXRed7eLWOb1XUyvRnIaIdyWDPgSgSsibdt7V/arZYtIG1o3UVoPoABg6g9e2FPV2pFqsoSeoG4DbSkvAjl1FnzQm05jugbrh2gIheI/QxXQhRD4L3l9/sjaQRs1/s2a4Zr4QvE8I4RZCwGIciJwb32jlafgLPDtcPkNT3F+AMTdxjUHN537UNwU9QS2V4teGqwtZIARgjqWY0ae4xSPJ7kDXmNRAgAPKyPBn7QCtSBLX46L4ql339EctiwFQN1J7I8djIQDFEvIhEdeWfjA/dFHGe1IDq4+XvwDQW9aB9BVzzLd73tGfk+n8xx6a6cgb6wOwQKKeiKpQxfsln/8koQVgsAdYaPOE0GA1dBF/UDAdeWpo8b1m5vWjVXmq60qnENoCaz/tF430ZakUb9gAdHpd0/XTutAhMe7Udb1/5eCiqkQbf5tfvXr5ym5N6EslfKIax717SwdGUikeMNnE/hOls/RxVzuASkmfGICG/QsHWwEADHpi8P5mAA0ysYoifB/d902vZK4JmJ4D3nCR23V52k4wnpH0YgK91rHo262PH5vbBNArEjGCmFd3lB1vk8wxieQnMYN8X5Y0AZAp5prlAMBL5KS8qavsu3flvQ0sZETLB4rrAdoOwJVJsgS2di85ldHBCKRwmfP2F1YL5n0EXJ9pUgDbeyoiG7Lgk9pt9OG+W4tBjoMAyxxIJgm5c+b575/cuwp6uh4T/VKk5vAts4WKDgIqUo1lIMhweoOeM5ZXBFnSeg94u4vcv7ujLQCeTiFsCMp4ZdBz6VI6Oc1I/0HDoMreWVuYsEVCHVGdannQc+F82vlMyPhFVn5oxnMM2gbAaSK5oAiuCD0aPZVpLiOy8qQs+3j6MgK3AchPWLqoKKgZWP7bYDbyGJG1N/ED7e5CUvkNYvYwKA+MT1WVXj7qGw9nK4eNjY2Njc3/jj8AuzXhYrmOV6EAAAAASUVORK5CYII=");
            height: 16px;
            width: 16px;
        }

        .lbl-onlyfiredTags {
            color: black;
        }

        .onlyFiredTags-chk {
            position: relative !important;
            opacity: 1 !important;
            pointer-events: all !important;
            top: 2px;
        }
    </style>
    <script>
        var piwik_translations = {};
    </script>
    <script type="text/javascript">

        window.angularDigest = function () {
            if ('undefined' === typeof jQuery) {
                return;
            }
            jQuery(function () {
                var $timeout = piwikHelper.getAngularDependency('$timeout');
                if ($timeout) {
                    $timeout(function () {});
                }
            });
        };
        window.mtmEvents = {
            events: [],
            push: function (event) {
                if (event) {
                    event.index0 = this.events.length;
                    event.index = this.events.length + 1;
                }
                this.events.push(event);

                window.angularDigest();
            }
        };
        window.mtmLogs = {
            logs: [],
            push: function (log) {
                this.logs.push(log);

                window.angularDigest();
            }
        };
    </script>
</head>
<body ng-app="app" >
    <div id="root" ng-controller="MtmDebugController as mtmDebug">
        <nav>
            <div class="nav-wrapper">
                <ul>
                    <li>{% include "@CoreHome/_logo.twig" %}</li>
                    <li ng-class="{'active': (mtmDebug.contentTab == 'tags' || !mtmDebug.contentTab)}"><a ng-click="mtmDebug.contentTab = 'tags'">Tags</a></li>
                    <li ng-class="{'active': (mtmDebug.contentTab == 'triggers')}"><a ng-click="mtmDebug.contentTab = 'triggers'">Triggers</a></li>
                    <li ng-class="{'active': (mtmDebug.contentTab == 'variables')}"><a ng-click="mtmDebug.contentTab = 'variables'">Variables</a></li>
                    <li ng-class="{'active': (mtmDebug.contentTab == 'dataLayer')}"><a ng-click="mtmDebug.contentTab = 'dataLayer'">Data Layer</a></li>
                    <li ng-class="{'active': (mtmDebug.contentTab == 'logs')}"><a ng-click="mtmDebug.contentTab = 'logs'">Logs</a></li>
                </ul>
            </div>
        </nav>

        <div class="page" style="clear:both;">
            <div id="secondNavBar" class="Menu--dashboard z-depth-1"
                 ng-show="mtmDebug.contentTab != 'logs'">
                <ul class="navbar" role="menu" style="padding: 0;">
                    <li class="menuTab" role="menuitem">
                        <span class="item" style="font-weight: normal;"> Events
                            <span ng-hide="(mtmDebug.mtmEvents|length) == 0">
                                <br><br>
                                <input type="checkbox" class="onlyFiredTags-chk" name="onlyfiredTags" id="onlyfiredTags" value="1" ng-model="onlyfiredTags">
                                <label for="onlyfiredTags" class="lbl-onlyfiredTags">Only fired tags</label>
                            </span>
                        </span>
                    </li>
                    <li ng-show="(mtmDebug.mtmEvents|length) == 0" style="padding: 0 0 1rem 1.2rem;">No event executed</li>
                    <li class="menuTab" role="menuitem" ng-class="{'active': eventIndex === mtmDebug.selectedEventIndex}"
                    ng-repeat="event in mtmDebug.mtmEvents | orderBy:'$index':true" ng-hide="!event.tags.length && onlyfiredTags">
                        <a class="item ng-binding"  ng-click="mtmDebug.selectEvent(event.index0)" title="Time: {{ '{{ event.time }}'|raw }}. Trigger: '{{ '{{ event.metTrigger.name }}'|raw }}'">
                            {{ '{{ event.index }}'|raw }}: {{ '{{ event.name }}'|raw }} <span title="Events with fired tags" class="{{ '{{ event.tags.length ? \'tm-icon-ok\' : \'\' }}' }}"></span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="pageWrap">
                <div class="home" id="content" ng-cloak>
                    <h2 ng-show="mtmDebug.contentTab != 'logs'">Event {{ '{{ mtmDebug.selectedEventIndex + 1 }}'|raw }}: {{ '{{ mtmDebug.selectedEvent.name }}'|raw }} ({{ '{{ mtmDebug.selectedEvent.container.id }} - {{ mtmDebug.selectedEvent.container.versionName || "Draft version" }}'|raw }})</h2>

                    <div ng-show="mtmDebug.contentTab == 'tags' || !mtmDebug.contentTab">
                        <h3>Fired Tags</h3>
                        <table class="entityTable">
                            <thead>
                            <tr>
                                <th>Action</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Fired count</th>
                            </tr>
                            </thead>
                            <tbody>
                                <tr ng-show="(mtmDebug.selectedEvent.tags|length) == 0">
                                    <td colspan="4">No tags</td>
                                </tr>
                                <tr ng-repeat="tag in mtmDebug.selectedEvent.tags">
                                    <td>{{ '{{tag.action }}'|raw }}</td>
                                    <td>{{ '{{tag.name }}'|raw }}</td>
                                    <td>{{ '{{tag.type }}'|raw }}</td>
                                    <td>{{ '{{tag.numExecuted }}'|raw }}</td>
                                </tr>
                            </tbody>
                        </table>

                        <h3 style="margin-top:30px;">Not Yet Fired Tags</h3>
                        <table class="entityTable">
                            <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-show="(mtmDebug.selectedEvent.notFiredTags|length) == 0">
                                <td colspan="4">No tags</td>
                            </tr>
                            <tr ng-repeat="tag in mtmDebug.selectedEvent.notFiredTags">
                                <td>{{ '{{tag.name }}'|raw }}</td>
                                <td>{{ '{{tag.type }}'|raw }}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-show="mtmDebug.contentTab == 'triggers'">
                        <h3>Triggers</h3>

                        <table class="entityTable">
                            <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                            </tr>
                            </thead>
                            <tbody>
                                <tr ng-show="!mtmDebug.selectedEvent.metTrigger">
                                    <td colspan="4">No trigger</td>
                                </tr>
                                <tr ng-show="mtmDebug.selectedEvent.metTrigger">
                                    <td>{{ '{{mtmDebug.selectedEvent.metTrigger.name }}'|raw }}</td>
                                    <td>{{ '{{mtmDebug.selectedEvent.metTrigger.type }}'|raw }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-show="mtmDebug.contentTab == 'dataLayer'">
                        <h3>Pushed data by this event</h3>

                        <table class="entityTable">
                            <tbody>
                            <tr>
                                <td>{{ '{{ mtmDebug.selectedEvent.eventData|json }}'|raw }}</td>
                            </tr>
                            </tbody>
                        </table>

                        <h3>Content after this event</h3>

                        <table class="entityTable">
                            <tbody>
                            <tr >
                                <td>{{ '{{ mtmDebug.selectedEvent.container.dataLayer|json }}'|raw }}</td>
                            </tr>
                            </tbody>
                        </table>

                    </div>
                    <div ng-show="mtmDebug.contentTab == 'variables'">
                        <table class="entityTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                            <tr ng-if="!mtmDebug.selectedEvent.container.variables.length">
                                <td colspan="3">No variables</td>
                            </tr>
                            <tr ng-repeat="variable in mtmDebug.selectedEvent.container.variables">
                                <td>{{ '{{variable.name }}'|raw }}</td>
                                <td>{{ '{{variable.type }}'|raw }}</td>
                                <td>{{ '{{variable.value|json }}'|raw }}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-show="mtmDebug.contentTab == 'logs'">
                        <table class="entityTable">
                            <thead>
                            <tr>
                                <th>Time</th>
                                <th>Message</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="log in mtmDebug.mtmLogs">
                                <td>{{ '{{log.time }}'|raw }}</td>
                                <td><span ng-repeat="logMessage in log.messages">{{ '{{ logMessage }}'|raw }}<br /></span></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include "_jsCssIncludes.twig" %}
</body>
</html>
